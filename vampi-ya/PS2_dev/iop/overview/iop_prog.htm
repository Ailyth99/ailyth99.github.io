<html lang="ja">
<!-- o@PCo -->
<head>

<script language="JavaScript">
<!--
  function startFixed(){
    fixedLAYER('fixedLay0','rightBottom',-35,-35)
  }

  var ie= !!document.all
  var n4= !!document.layers
  var w3c=!!document.getElementById
  var mac45 
    = navigator.userAgent.indexOf('MSIE 4.5; Mac_PowerPC')

  if(document.layers)window.onresize=resizeFunc
  function resizeFunc(e){location.reload()}

  function iniFunc(){
    if(ie&&!(mac45!=-1))window.onscroll = startFixed
    startFixed()
  }

  var tid=new Array()

  function fixedLAYER(layName,posString,offSetX,offSetY){

    offSetX = parseInt(offSetX,10)
    offSetY = parseInt(offSetY,10)

 if( posString == 'rightBottom' ){

      if(ie) offLeft = document.body.clientWidth   + offSetX
      else   offLeft = window.innerWidth           + offSetX
      if(ie) offTop  = document.body.clientHeight  + offSetY
      else   offTop  = window.innerHeight          + offSetY

    }
    else {

      if(ie) offLeft =                               offSetX
      else   offLeft =                               offSetX
      if(ie) offTop  =                               offSetY
      else   offTop  =                               offSetY

    }

    offLeft = parseInt(offLeft)
    offTop  = parseInt(offTop)

    if(document.all){
      var mx = parseInt(document.body.scrollLeft +offLeft)
      var my = parseInt(document.body.scrollTop  +offTop)
    } else {
      var mx = parseInt(self.pageXOffset+offLeft)
      var my = parseInt(self.pageYOffset+offTop)

    }

    moveLAYER(layName,mx,my)

    if(!(ie&&!(mac45!=-1)))
      setTimeout("fixedLAYER('"+layName+"','"+posString
                   +"','" +offSetX+"','"+offSetY+"')",100)
  }

  function moveLAYER(layName,x,y){
      
      if(document.getElementById){
        document.getElementById(layName).style.left=x
        document.getElementById(layName).style.top=y
      }
      else if(document.all){
        document.all(layName).style.pixelLeft=x
        document.all(layName).style.pixelTop=y
      }
      else if(document.layers)
        document.layers[layName].moveTo(x,y)
  }

// -->
</script>

<script language="JavaScript">
<!--
  function lj(ch,fm)
  {
    if ( parent.index ) {
      if ( ch == "libref" ){ parent.index.location.href="../libref/category.htm"; }
      else if ( ch == "../ee/libref" ){ parent.index.location.href="../../ee/libref/category.htm"; }
      else if ( ch == "../iop/libref" ){ parent.index.location.href="../../iop/libref/category.htm"; }
      else if ( ch == "../iop/overview" ){ parent.index.location.href="../../iop/overview/category.htm"; }
      else if ( ch == "../ee/overview" ){ parent.index.location.href="../../ee/overview/category.htm"; }
      else if ( ch == "overview" ){ parent.index.location.href="../overview/category.htm"; }
    }
    if ( parent.main ) {
      if ( fm != "" ){ parent.main.location.href=fm; }
    } else {
      if ( fm != "" ){ location.href=fm; }
    }
  }
//-->
</script>
<title>IOPvO~O</title>
<meta http-equiv="Content-Type"content= text/html; charset=UTF-8 >
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta name="Author" Content="Sony Computer Entertainment Inc.">
<style type="text/css"><!--
    div.fixedLay{position:absolute;z-index:100;left:0px;top:0px;}
--></style>
</head>
<body onload="iniFunc()" bgcolor="#ffffff" text="#000000" >
<div id="fixedLay0" class="fixedLay">
<a href="#top"><img src="gif/link.gif" border="0" alt="TOP"></a>
</div>
<table WIDTH="100%">
<tr><td>
<h3>"PlayStation 2" Programmer Tool Runtime Library Release 2.5.3</h3>
</td>
</tr>
<tr><td align= right >
<script language="JavaScript">
<!--
   var p,q;
   if ( parent.index ) {
   p = parent.index.location;
   q = p.toString();
   result = q.match(/\/category\.htm/gi);
   if(result == "/category.htm"){
          document.writeln("<a href=\"JavaScript:lj('libref','../libref/ikrnl_rf.htm')\"><img src=\"./gif/arrow.png\" border=0>\Ì^Öê——</a>");
    }
}
// -->
</script>
</td></tr>
</table>
<hr noshade size=6>
<a name=Heading2>
<center><h1>
IOPvO~O
</h1></center>
</a>
<div align=center>
<table border=0 bgcolor=#F5F5F5 width=90%><tr><td>
<h2><u>
        <b>Ú</b><br>
</u></h2>

<ul>
<p><a href="#Heading3_1">  1 <b>Tv</b></a>
    <ul>
    <a href="#Heading4_1_1"> <b>W[</b><br></a>
    <a href="#Heading4_1_2"> <b>W[Ì‘İŠÔií’“ / í’“j</b><br></a>
    <a href="#Heading4_1_3"> <b>vO[_</b><br></a>
    </ul>
<p><a href="#Heading3_2">  2 <b>W[Ì\</b></a>
    <ul>
    <a href="#Heading4_2_1"> <b>ZOgÌ”zu</b><br></a>
    <a href="#Heading4_2_2"> <b>W[ID</b><br></a>
    <a href="#Heading4_2_3"> <b>W[ÆƒW[o[W</b><br></a>
    </ul>
<p><a href="#Heading3_3">  3 <b>W[Ìƒ[hÆ‹N</b></a>
    <ul>
    <a href="#Heading4_3_1"> <b>[hÆ‹NÌè‡</b><br></a>
    <a href="#Heading4_3_2"> <b>Gg[`</b><br></a>
    </ul>
<p><a href="#Heading3_4">  4 <b>W[Ì’~ÆƒA[h</b></a>
    <ul>
    <a href="#Heading4_4_1"> <b>~ÆƒA[hÌè‡</b><br></a>
    <a href="#Heading4_4_2"> <b>È’~ÆÈƒA[h</b><br></a>
    </ul>
<p><a href="#Heading3_5">  5 <b>í’“Cu</b></a>
    <ul>
    <a href="#Heading4_5_1"> <b>í’“CuÌ‚</b><br></a>
    <a href="#Heading4_5_2"> <b>Gge[u\Ì‚ÆƒCuGg`t@C</b><br></a>
    <a href="#Heading4_5_3"> <b>Ä‚Ñoe[u\</b><br></a>
    <a href="#Heading4_5_4"> <b>XPg</b><br></a>
    </ul>
<p><a href="#Heading3_6">  6 <b>RpCÌè‡</b></a>
    <ul>
    <a href="#Heading4_6_1"> <b>P[^uvOÌƒRpC</b><br></a>
    <a href="#Heading4_6_2"> <b>í’“CuÌƒRpC</b><br></a>
    </ul>
<p><a href="#Heading3_7">  7 <b>QlFW[ÔƒNÌdg</b></a>
    <ul>
    <a href="#Heading4_7_1"> <b>Gge[u\</b><br></a>
    <a href="#Heading4_7_2"> <b>Ä‚Ñoe[u\</b><br></a>
    <a href="#Heading4_7_3"> <b>ilbt@CtH[}bg</b><br></a>
    <a href="#Heading4_7_4"> <b>NÌŒİŠ`FbN</b><br></a>
    </ul>
<p><a href="#Heading3_8">  8 <b>QlFIOPIuWFNgtH[}bg</b></a>
    <ul>
    <a href="#Heading4_8_1"> <b>IOPW[ZNV</b><br></a>
    <a href="#Heading4_8_2"> <b>t@CÌƒf[^CAEg</b><br></a>
    <a href="#Heading4_8_3"> <b>Ìƒf[^CAEg</b><br></a>
    <a href="#Heading4_8_4"> <b>ELFwb_ÌÚ</b><br></a>
    <a href="#Heading4_8_5"> <b>vOwb_e[uÌÚ</b><br></a>
    <a href="#Heading4_8_6"> <b>\V{</b><br></a>
    <a href="#Heading4_8_7"> <b>V{e[uGg</b><br></a>
    <a href="#Heading4_8_8"> <b>P[Ve[uGg</b><br></a>
    <a href="#Heading4_8_9"> <b>fobO</b><br></a>
    </ul>
<br></td></tr></table></div>

<!-- o@QCÍŒo -->
<a name=#"Heading2">

<!-- o@RCßŒo -->
<a name="Heading3_1">
<h2>
 1 <b>Tv</b>
<hr noshade>
</h2>


<!-- o@SCo -->
<h3>
<a name="Heading4_1_1">
<a href="#Heading3_1"> 1. </a>1 <b>W[</b><br>
</a>
</h3>
<div style="margin-left:50px;">IOPÌƒÉ‚Í•ÌƒvO[hé‚±Æ‚Â”\Å‚B<br>vOROMCD/DVD-ROMÉƒP[^uIuWFNgt@CÆ‚ÄŠi[Ä‚Ü‚AKvÉ‰ÄƒÌ‹ó‚¢‚Ä‚ÌˆÉƒ[hA[hê‚½AhXÉí‚¹ÄƒP[gÄsÜ‚BIOPpIuWFNgt@CÍ’Ê '.irx' ÌŠgqAIRXt@CÆŒÄ‚Î‚é‚±Æ‚Ü‚BIRXt@CçƒÉƒ[hêƒŠP[gê‚½Ô‚ÌƒvOAvOW[Ü‚Í’PÉƒW[ÆŒÄ‚Ñ‚Ü‚B<br>W[Í‚ê‚¼Ğ‚Æ‚Â‚ÌƒGg[`iÊstartÖjÜ‚BW[[hÆƒGg[`Ä‚ÑoAÌ•Ô‚lÉ‚ÄAW[Éí’“é‚©Ç‚ß‚Ü‚B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_1_2">
<a href="#Heading3_1"> 1. </a>2 <b>W[Ì‘İŠÔií’“ / í’“j</b><br>
</a>
</h3>
<div style="margin-left:50px;">W[ÍAê‚ªÉ‘İ‚Ô‚É‚Ä•Ş‚é‚±Æ‚Å‚Ü‚B<br>Ü‚AGg[`xsÆ–Ú‚IÄƒéƒ‚W[Ü‚BÌ‚æ‚¤ÈƒW[í’“W[ÆŒÄ‚Ñ‚Ü‚B<br>tÉAGg[`ÌsIÉ—Ü‚Aèİ‚â‘¼ÌƒW[ÌƒNGXgÆ‚É‚Ì‚Â‚ÇsW[Ü‚BÌ‚æ‚¤ÈƒW[í’“W[ÆŒÄ‚Ñ‚Ü‚BÉAÌƒW[Tu[`Æ‚ÄŒÄ‚ÑoGgÂƒW[í’“CuÆŒÄ‚Ñ‚Ü‚B<br>í’“W[Ì’É‚Í‚ÉAKvÈ‚È‚Æ‚É‚ÍƒÅ‚Ì‚Ü‚BÌ‚æ‚¤ÈƒW[A[hÂ”\Èí’“W[ÆŒÄ‚Ñ‚Ü‚B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_1_3">
<a href="#Heading3_1"> 1. </a>3 <b>vO[_</b><br>
</a>
</h3>
<div style="margin-left:50px;">vO[_ÍACD/DVD-ROMROMvOW[[h/P[gAÅ‚ÌƒW[ÌŠÇ—sÜ‚B<br>vO[_ÍAwÌƒW[}l[WÆwÌƒt@C[_É‚í‚©Ü‚B<br>W[}l[WÍˆÈ‰Ì‚Æ‚sÜ‚B<br></div>
<div style="margin-left:40px;"><ul>
         <li> t@C[_^ê‚½irx`ÌƒIuWFNgf[^ÌŒÆƒIuWFNgÌÄ”zu
         <li> [hW[Ô‚ÌƒN
         <li> í’“CuÌŠÖÌƒGge[uÌ“o^ / íœÌŠÇ—
</ul></div>
<div style="margin-left:50px;">t@C[_ÍˆÈ‰Ì‚Æ‚sÜ‚B<br></div>
<div style="margin-left:40px;"><ul>
         <li> fBXNÉ‚IuWFNgt@CÌƒ[hÆ‹N
         <li> W[Ì“o^ / íœÌŠÇ—
</ul></div>
<div style="margin-left:50px;"><br></div>

<!-- o@RCßŒo -->
<a name="Heading3_2">
<h2>
 2 <b>W[Ì\</b>
<hr noshade>
</h2>


<!-- o@SCo -->
<h3>
<a name="Heading4_2_1">
<a href="#Heading3_2"> 2. </a>1 <b>ZOgÌ”zu</b><br>
</a>
</h3>
<div style="margin-left:50px;">IOPÌƒÅ‚Í‚Ğ‚Æ‚Â‚ÌƒW[ÍˆÈ‰Ì‚RÂ‚ÌƒZOgÈ‚AeZOgÍ‰}ÌÅ˜AÄ”zuAê‚¼ÌƒTCY16byteÌ”{É‚È‚Ä‚Ü‚B<br><br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>ZOg</b>&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>e</b>&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;TEXT segment&nbsp;</td>
<td valign="TOP">&nbsp;vOR[hiK{j&nbsp;<br>&nbsp;CXgNVR[hÆƒW[ÔƒNÌ‚ß‚&nbsp;<br>&nbsp;f[^\Ü‚Ü‚Ü‚B&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;DATA segment&nbsp;</td>
<td valign="TOP">&nbsp;lÂ‚f[^iê‡j&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;BSS segment&nbsp;</td>
<td valign="TOP">&nbsp;lf[^GAiê‡j&nbsp;</td>
</tr>
</table>
</div>
<br>
<br>
<div style="margin-left:50px;"></div>
<div style="margin-left:50px;"></div>
<div style="margin-left:67px;">
<p>
<img src="gif/iop_prog001.gif"><p>

</div>
<br>

<!-- o@SCo -->
<h3>
<a name="Heading4_2_2">
<a href="#Heading3_2"> 2. </a>2 <b>W[ID</b><br>
</a>
</h3>
<div style="margin-left:50px;">Éƒ[hê‚½W[É‚ÍÊ—pIDÔè“–Ä‚Ü‚BIDÔW[IDÆŒÄ‚Ñ‚Ü‚B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_2_3">
<a href="#Heading3_2"> 2. </a>3 <b>W[ÆƒW[o[W</b><br>
</a>
</h3>
<div style="margin-left:50px;">W[É‚ÍAW[ÆƒW[o[WÂ‚é‚±Æ‚Å‚Ü‚BW[Ìƒ\[XvOÅAÈ‰Ì‚æ‚¤ÉéŒ¾Ä‚B<br></div>
        <div style="margin-left:80px;"><pre><font size=3>ModuleInfo Module = {"Module_name", o[WÔ };
</pre></font></div>
<div style="margin-left:50px;">O[oÏModuleÍƒW[ÆƒW[o[Wwè‚·prÌ‚ß‚É—\ñ‚³‚Ä‚Ü‚B<br>ModuleInfo\Ì‚ÍAkernel.hÅÌ‚æ‚¤É’`Ä‚Ü‚B<br></div>
        <div style="margin-left:80px;"><pre><font size=3>typedef struct _moduleinfo {
	const char		*name;
	const unsigned short	version;
} ModuleInfo;
</pre></font></div>
<div style="margin-left:50px;">nametB[hÉ‚ÍAW[Ì–Ì‚wè‚µÜ‚BÌ‚Égpé•¶ÍApA'_'A'/' ÉŒè‚·é‚±Æ‚ğ„Ü‚B<br>versiontB[hÌ8bitÉ‚ÍƒW[ÌƒW[o[Wİ’è‚µA8bitÉ‚Íƒ}Ci[o[Wİ’è‚µÜ‚BW[o[WA}Ci[o[WÆ‚A1ÈÌ’lpÜ‚B0ÍgpÈ‚Å‚B<br>W[ÆƒW[o[WÍAÉˆÈ‰Ì—prÅgpÜ‚B<br></div>
<div style="margin-left:40px;"><ul>
         <li> VXeu[gÉƒu[g[_v[XW[mé‚½
         <li> vOiW[jAmÌƒW[ÂƒW[ÌƒW[IDæ“¾é‚½
         <li> vO}fobOÌƒW[Ìƒ[hAhXcé‚½
         <li> fobKu[gÏ‚ÌƒW[ÆƒfBXNÌƒIuWFNgt@CÌ“ê«mFé‚½
</ul></div>
<div style="margin-left:50px;">È‚AIOPÌƒvO[_ÍAW[ÆƒW[o[WÂ‚Ä‚È‚vOÅ‚È‚[hsé‚±Æ‚Å‚Ü‚BÜ‚AW[ÆƒW[o[WÌˆvé•¡ÌƒW[É‘İ‚é‚±Æ‚Ä‚Ü‚B<br></div>

<!-- o@RCßŒo -->
<a name="Heading3_3">
<h2>
 3 <b>W[Ìƒ[hÆ‹N</b>
<hr noshade>
</h2>

<div style="margin-left:50px;">vO[_ÍAIOPÌƒVXeu[gLoadStartModule()È‚Ç‚APIÉ‚ÄwÆ‚ÉAIOPIuWFNgt@C[hAW[ÌƒGg[`Ä‚ÑoÜ‚BGg[[`Ì–ß‚lÉ‚ÄAÌƒW[Éí’“é‚©é‚©è‚³Ü‚B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_3_1">
<a href="#Heading3_3"> 3. </a>1 <b>[hÆ‹NÌè‡</b><br>
</a>
</h3>
<div style="margin-left:50px;">W[Ìƒ[hÆƒGg[`ÌŒÄ‚ÑoÍˆÈ‰Ìè‡ÅsÜ‚B<br></div>
    <div style="margin-left:55px;"><ol>
         <li VALUE=1> IOPIuWFNgt@C`ÌƒIuWFNgf[^ğ’²‚×AKvÈ‚ÎƒmÛ‚AIuWFNgÇ‚İñ‚¾ŒAIuWFNgÄ”zu</li>
         <li VALUE=2> W[BSS segment[NA</li>
         <li VALUE=3> W[TEXT segmentğ’²Aí’“CuÌŠÖÄ‚ÑoÄ‚ÎƒN</li>
         <li VALUE=4> W[ÉƒW[IDè“–Ä‚</li>
         <li VALUE=5> W[ÌƒGg[`Ä‚Ño</li>
         <li VALUE=6> Gg[`Ì–ß‚lÉ‚ÄAÌƒW[í’“é‚©Û‚è‚µ</li>
</ol></div>
</ul></div>
<div style="margin-left:50px;">LÌè‡É‚ÄAW[Í‰}Ì‚æ‚¤ÉÔ‘JÚ‚Ü‚B<br></div>
<div style="margin-left:50px;"></div>
<div align=center>
<p>
<img src="gif/iop_prog002.gif"><p>

</div>
<br>

<!-- o@SCo -->
<h3>
<a name="Heading4_3_2">
<a href="#Heading3_3"> 3. </a>2 <b>Gg[`</b><br>
</a>
</h3>
<div style="margin-left:50px;">W[ÌƒGg[`ÍAÌ‚æ‚¤Èƒvg^CvÈ‚Î‚È‚Ü‚B<br></div>
        <div style="margin-left:80px;"><pre><font size=3>int start(intc argc, char *argv[]);
</pre></font></div>
<div style="margin-left:50px;">vO[_ÍAGg[`spÉŠmÛ‚Ä‚XbhNAÌƒXbhÌ’ÅˆÈ‰Ìè‡ÅƒGg[`Ä‚ÑoÜ‚B<br></div>
    <div style="margin-left:55px;"><ol>
         <li VALUE=1> X^bNÉAargv[]zÆˆÏ‚</li>
         <li VALUE=2> W[GP(global pointer)valueGP register($28)ÉƒZbg</li>
         <li VALUE=3> Gg[`Tu[`R[</li>
         <li VALUE=4> iW[ÌƒGg[[`sj</li>
         <li VALUE=5> Gg[`Ì–ß‚lÌ‰2rbgÉ‚ÄƒW[Ìí’“^í’“è‚·</li>
         <li VALUE=6> XbhI</li>
</ol></div>
</ul></div>
<div style="margin-left:50px;">W[ÌƒvO}ÍƒGg[`È‰ÌŠÂ‹Å“ì‚·æ‚¤É‘gÜ‚È‚Î‚È‚Ü‚B<br></div>
<div style="margin-left:40px;"><ul>
         <li> sXbhÌƒX^bNTCY2KB
         <li> sXbhÌ—Dæ‡Ê‚MODULE_INIT_PRIORITY(=8)
         <li> argcÍˆÊ“ICmainÖÌˆÆ“i1Èj
         <li> argvÍˆÊ“ICmainÖÌˆÆ“
</ul></div>
<div style="margin-left:50px;">Gg[`spÉŠmÛ‚Ä‚XbhÍ‚Ğ‚Æ‚Â‚È‚Ì‚ÅAÙ‚È‚éƒ‚W[ÌƒGg[`sÄsé‚±Æ‚ÍŒÆ‚Ä‚Ü‚BÄAÊÌƒW[ÌƒGg[`Å‚ÍAÌƒW[ÌƒGg[`Æé‚±Æ‚lKvÍ‚Ü‚BOÆ‚ÄAGg[`Ì‚È‚LoadStartModule()È‚Ç‚APIpÄ‚É‘ÌƒW[Nê‡ÍAGg[`ÌslXgÜ‚BÌŒÊAgpÂ”\X^bNTCYÉŒÜ‚B<br>Gg[`Ì–ß‚lÌ‰2rbgÍAÈ‰Ì‚ê‚©É‚È‚Î‚È‚Ü‚BÌ‘ÌƒrbgÍRÉgÄ‚Ü‚Ü‚B<br><br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>l</b>&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>Ó–</b>&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;NO_RESIDENT_END&nbsp;</td>
<td valign="TOP">&nbsp;W[ÍƒŞ‹ií’“W[j&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;RESIDENT_END&nbsp;</td>
<td valign="TOP">&nbsp;W[ÍƒÉí’“ií’“W[j&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;REMOVABLE_RESIDENT_END&nbsp;</td>
<td valign="TOP">&nbsp;W[ÍƒÉí’“&nbsp;<br>&nbsp;iA[hÂ”\í’“W[j&nbsp;</td>
</tr>
</table>
</div>
<br>

<div style="margin-left:40px;"><h4><b>í’“W[ÌƒvOÌƒXPg</b><br></h4></div>

        <div style="margin-left:80px;"><pre><font size=3>#include &lt;kernel.h&gt;

int start(int argc, char *argv[])
{
	/* vOÌ‚×‚Æ‚sB*/
	return NO_RESIDENT_END;
}
</pre></font></div>

<div style="margin-left:40px;"><h4><b>í’“W[ÌƒvOÌƒXPg</b><br></h4></div>

        <div style="margin-left:80px;"><pre><font size=3>#include &lt;kernel.h&gt;

int start(int argc, char *argv[])
{
    /* W[Ìí’“É•KvÈÈ‚Ç‚sB*/
    if( É )
        return RESIDENT_END;
    else
        return NO_RESIDENT_END;
}
</pre></font></div>

<!-- o@RCßŒo -->
<a name="Heading3_4">
<h2>
 4 <b>W[Ì’~ÆƒA[h</b>
<hr noshade>
</h2>

<div style="margin-left:50px;">Gg[`REMOVABLE_RESIDENT_ENDÔ‚í’“W[ÍAvO[_ÉƒA[hÂ”\Èí’“W[Å‚Æ”FAí’“StopMdoule()UnloadModule()2Â‚APIÉ‚Äíœé‚±Æ‚Â”\É‚È‚Ü‚B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_4_1">
<a href="#Heading3_4"> 4. </a>1 <b>~ÆƒA[hÌè‡</b><br>
</a>
</h3>
<div style="margin-left:50px;">vO[_ÍAí’“W[Ìƒ[hÉƒW[gi[éƒÌˆmÛ‚AA[hÉ‚ÌƒÌˆÜ‚BÈŠOÉí’“W[gÌsÌ‰ß’ÅŠmÛ‚ê‚½i / Xbh / CxgtO / Z}tHjÎAÍƒvO[_ÌŠÇ—OÅ‚Ì‚ÅAí’“W[gÅ‰KvÜ‚B<br>Ì‚ßí’“W[ÌƒA[hÍAÜ‚W[ÅÌ‰È‚Ç‚s~ÆAW[}l[WÅí’“W[íœíœ2iKÅsÜ‚B<br>í’“W[Ì’~sAPIStopModule()Å‚BStopModule()sÆAvO[_ÍƒGg[`spÉŠmÛ‚Ä‚XbhNAÌƒXbhÌ’ÅˆÈ‰Ìè‡ÅƒGg[`Ä‚ÑoÜ‚B<br></div>
    <div style="margin-left:55px;"><ol>
         <li VALUE=1> X^bNargv[]zÆˆÏ‚ŞBargv[0]É‚Í"other"Æ‚İ’è‚·BÜ‚A~ÌŒÄ‚ÑoÅ‚é‚±Æ‚\ß‚ÉAargcÉ‚Í•Ì’liÎ’largv[]Å“nÌjİ’è‚·</li>
         <li VALUE=2> W[GP(global pointer) valueGP register($28)ÉƒZbg</li>
         <li VALUE=3> Gg[`Tu[`R[</li>
         <li VALUE=4> iW[ÌƒGg[[`sBargcÅ‚é‚±Æ‚ğ”»•Ê‚ÄÌ‰È‚Ç‚sj</li>
         <li VALUE=5> Gg[`Ì–ß‚lÌ‰2rbgNO_RESIDENT_ENDÅ‚Î’~Ì‚Æ‚AW[~Ô‚Æ‚İ‚È‚Bß‚lREMOVABLE_RESIDENT_ENDÅ‚ÎA~sÅƒW[ÍˆÒ“Ô‚Å‚Æ‚İ‚È‚</li>
         <li VALUE=6> XbhI</li>
</ol></div>
</ul></div>
<div style="margin-left:50px;">í’“W[ÌíœsAPIUnloadModule()Å‚BUnloadModule()ÍAÎÛƒW[~Ô‚Å‚é‚±Æ‚mFAW[Ì“o^íœÜ‚BÜ‚ÎÛƒW[Ìß‚éƒÌˆæ‚ª[hÉIÉŠmÛ‚ê‚½Ì‚Å‚Î‰Ü‚B<br>LÌè‡É‚ÄAW[Í‰}Ì‚æ‚¤ÉÔ‘JÚ‚Ü‚B<br></div>
<div style="margin-left:50px;"></div>
<div align=center>
<p>
<img src="gif/iop_prog003.gif"><p>

</div>
<br>

<div style="margin-left:40px;"><h4><b>A[hÂ”\í’“W[ÌƒvOÌƒXPg</b><br></h4></div>

        <div style="margin-left:80px;"><pre><font size=3>#include &lt;kernel.h&gt;

int module_start(int argc, char *argv[]) {
	/* W[Ìí’“É•KvÈÈ‚Ç‚sB*/
	if( É )
		eturn REMOVABLE_RESIDENT_END;
	else {
		/* KvÈ‚ÎAÌƒLZs */
		return NO_RESIDENT_END;
	}
}

int module_stop(int argc, char *argv[]) {
	/* W[ÌíœOÉ•KvÈIÈ‚Ç‚sB*/
	if( IÉ )
		return NO_RESIDENT_END;
	else {
		/* Â”\È‚ÎAIÌƒLZsA
		* í’“ğ‘±sÅ‚æ‚¤ÈÔ‚É–ß‚B*/
		return REMOVABLE_RESIDENT_END;
	}
}

int start(int argc, char *argv[]) {
	if( argc &gt;= 0 )    return module_start(argc, argv);
	else               return module_stop(-argc, argv);
}
</pre></font></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_4_2">
<a href="#Heading3_4"> 4. </a>2 <b>È’~ÆÈƒA[h</b><br>
</a>
</h3>
<div style="margin-left:50px;">StopModule() / UnloadModule()Å‚ÍAÈƒW[ÎÛ‚É‚é‚±Æ‚Í‚Å‚Ü‚BÈƒW[A[hé‚½ß‚É‚ÍASelfStopModule() / SelfUnloadModule()gpAÈ‰Ì“_É’Ó‚È‚Î‚È‚Ü‚B<br></div>
<div style="margin-left:40px;"><ul>
         <li> ÈƒA[héƒ‚W[SelfStopModule() / SelfUnloadModule()sé‚½ß‚ÌƒXbhì¬È‚Î‚È‚
         <li> Gg[[`Å’~Æ‚ÉLÌƒXbhíœÈ‚æ‚¤É‚È‚Î‚È‚È‚
         <li> ÌƒW[íœÂ”\lÙ‚æ‚¢
</ul></div>
<div style="margin-left:50px;">SelfStopModule()sÆAStopModule()Ì‚Æ‚Æ“lÉƒW[ÌƒGg[[`Ä‚ÑoÜ‚BStopModule()Æˆá‚¤_argv[0]É—^é•¶"self"É‚È‚é‚±Æ‚Å‚BÄƒGg[`ÍAargv[0]Ì“eÉ‰ÄA~Åíœ×‚XbhÌğ”»’fÈ‚Î‚È‚Ü‚B<br>ÈƒA[hP[XÜ‚ß‚W[ÌÔ‘JÚ‚Í‰}Ì‚æ‚¤É‚È‚Ü‚B<br></div>
<div style="margin-left:50px;"></div>
<div align=center>
<p>
<img src="gif/iop_prog004.gif"><p>

</div>
<br>

<div style="margin-left:40px;"><h4><b>ÈƒA[hÂ”\í’“W[ÌƒvOÌƒXPg</b><br></h4></div>

        <div style="margin-left:80px;"><pre><font size=3>#include &lt;kernel.h&gt;

/* ÈíœÂ”\í’“W[ÍAÈ‰Ì‚æ‚¤
 * È‚íœé‚½ß‚ÌƒXbhÈ‚Î‚È‚È‚ */
int special_thread() {
	:
	:
	SelfStopModule(args, argp, &result);
	SelfUnloadModule(); /* Unload & ExitDeleteThread */
	/* Never returns here */
}

int module_start(int argc, char *argv[]) {
	/* W[Ìí’“É•KvÈÈ‚Ç‚sB
	* SelfStopModule()/SelfUnloadModule() sé‚½ß‚
	* XbhÅì¬B
	*/
	if( É )
		return REMOVABLE_RESIDENT_END;
	else {
		/* KvÈ‚ÎAÌƒLZs */
		return NO_RESIDENT_END;
	}
}

int module_stop(int argc, char *argv[]) {
	if( strcmp(argv[0],"other") == 0 ) {
		/* ÌƒW[É‚ StopModule() ê‚½P[XB
		* W[ÌíœOÉ•KvÈIÈ‚Ç‚sB
		*/
	} else if( strcmp(argv[0],"self") == 0 ) {
		/* W[É‚ SelfStopModule() ê‚½P[XB
		* W[ÌíœOÉ•KvÈIÈ‚Ç‚sB
		* ASelfStopModule()/SelfUnloadModule() s
	* XbhÍíœÈ‚B
	*/
	}
	if( IÉ )
		return NO_RESIDENT_END;
	else {
		/* Â”\È‚ÎAIÌƒLZsA
		* í’“ğ‘±sÅ‚æ‚¤ÈÔ‚É–ß‚B*/
		return REMOVABLE_RESIDENT_END;
	}
}

int start(int argc, char *argv[]) {
	if( argc &gt;= 0 )    return module_start(argc, argv);
	else               return module_stop(-argc, argv);
}
</pre></font></div>

<!-- o@RCßŒo -->
<a name="Heading3_5">
<h2>
 5 <b>í’“Cu</b>
<hr noshade>
</h2>

<div style="margin-left:50px;">í’“W[ÍAÌ‚ÂŠÖQÌˆê•”ğ‘¼‚ÌƒW[É’ñ‹Ÿ‚í’“CuÉ‚È‚é‚±Æ‚Å‚Ü‚B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_5_1">
<a href="#Heading3_5"> 5. </a>1 <b>í’“CuÌ‚</b><br>
</a>
</h3>
<div style="margin-left:50px;">í’“CuÍAÌƒW[É’ñ‹Ÿ‚Tu[`GgÜ‚Æ‚ß‚Gge[u\Ì‚Æ‚Î‚\Ì‚Ü‚BÊÍƒW[Ìí’“ÉARegisterLibraryEntries()gpÄÌÂƒGge[u\Ì‚VXeÉ“o^Ü‚BÜ‚~É‚ÍAGge[u\Ì‚Ì“o^ReleaseLibraryEntries()gpÄsÜ‚B<br>Aí’“Cuğ—˜—péƒ‚W[ÍApTu[`ÌƒCfbNXÜ‚Æ‚ß‚Ä‚Ñoe[u\Ì‚Ü‚BÌƒW[[hÆ‚ÉAÄ‚Ñoe[uo^Ï‚İ‚Ìí’“CuÌƒGge[u\Ì‚ÆÆAYTu[`ÌƒGgAhXÉÜ‚B<br></div>
<div style="margin-left:50px;"></div>
<div style="margin-left:67px;">
<p>
<img src="gif/iop_prog005.gif"><p>

</div>
<br>
<div style="margin-left:50px;">A[hÂ”\Èí’“W[í’“CuÆ‚é‚±Æ‚Â”\Å‚BÌê‡ÍLÌƒGge[u\Ì‚ÉŠÖ‚éˆÆ‚Æ‚ÉAA[hÂ”\Èí’“W[É•KvÈ’~sKvÜ‚B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_5_2">
<a href="#Heading3_5"> 5. </a>2 <b>Gge[u\Ì‚ÆƒCuGg`t@C</b><br>
</a>
</h3>
<div style="margin-left:50px;">Gge[u\Ì‚ÍACuGg`t@CÆ‚ioplibgen[eBeBpÄì¬é‚±Æ‚Å‚Ü‚B<br>CuGg`t@CÍAÈ‰4Ş‚Ì‹LqÜ‚Ü‚ê‚½eLXgt@CÅ‚B<br></div>

<!-- o@TCiPj -->
<div style="margin-left:40px;"><a name="Heading5_5_2_1"><h4>
(1)&nbsp;<b>Rg</b><br></h4>
</a></div>
<div style="margin-left:67px;">'#'ÅnÜ‚sÍƒRgsÉ‚È‚Ü‚B<br></div>

<!-- o@TCiPj -->
<div style="margin-left:40px;"><a name="Heading5_5_2_2"><h4>
(2)&nbsp;<b>CuéŒ¾</b><br></h4>
</a></div>
<div style="margin-left:67px;">Cui8È“jÈ‰Ì‚æ‚¤ÉéŒ¾Ü‚B<br></div>
        <div style="margin-left:80px;"><pre><font size=3>Libname libname
</pre></font></div>

<!-- o@TCiPj -->
<div style="margin-left:40px;"><a name="Heading5_5_2_3"><h4>
(3)&nbsp;<b>Cuo[WéŒ¾</b><br></h4>
</a></div>
<div style="margin-left:67px;">CuÌƒW[o[Wi8bitjÆƒ}Ci[o[Wi8bitjA '.' Å‹Ø‚10iÅˆÈ‰Ì‚æ‚¤Éwè‚µÜ‚<br></div>
<div style="margin-left:80px;">Version <i>MM</i>.<i>mm</i><br></div>
<div style="margin-left:67px;">W[o[WÆƒ}Ci[o[WÍA1È255È‰Ìlwè‚µÄ‚B0ÍƒU[uÄ‚Ü‚B<br></div>

<!-- o@TCiPj -->
<div style="margin-left:40px;"><a name="Heading5_5_2_4"><h4>
(4)&nbsp;<b>GgéŒ¾</b><br></h4>
</a></div>
<div style="margin-left:67px;">È‰ÌÅACuÌƒGgÖğ•¡éŒ¾Å‚Ü‚B<br></div>
<div style="margin-left:80px;">Entry/<i>level</i> <i>entry_symbol</i> [<i>entry_internal_symbol</i>]<br>Entry <i>entry_symbol</i> [<i>entry_internal_symbol</i>]<br>Entry -<br></div>
<div style="margin-left:67px;"><i>level</i>ÍA<i>entry_symbol</i>ÌŒJx1ÌlÅwè‚µÜ‚Bioplibgen-lIvVÅŒJxwè‚·ÆAÌlÈ‰ÌŒJx<i>entry_symbol</i>Ì‚İ‚Gge[ut@CÉoÍ‚Ü‚B<i>level</i>È—ÆŒJx0Æ‚İ‚È‚Ü‚B<br></div>

<div style="margin-left:40px;"><h4><b>\Gg</b><br></h4></div>

<div style="margin-left:67px;">Gge[u\Ì‚É“o^Ä‚ÖÍsÉ‚Íƒe[uÌÔiCfbNXjÉ‚ÄÊ‚Ü‚BÖÆƒe[uÌƒCfbNXÌ‘Î‰ÍAÆ‚Ä‚ÍƒvO}RÉŒß‚Ä‚Ü‚Ü‚B<br>AVXeT[rXÌŠÇ—Ì“sÅAÅÌ‚SÂ‚ÌƒGgÍŠÖÉŠÖ‚ç‚¸AÈ‰Ì‚æ‚¤É–Å’è‚³Ä‚Ü‚B<br><br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>CfbNX</b>&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>ÖÌ‹@\</b>&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;0&nbsp;</td>
<td valign="TOP">&nbsp;CuÌpÉ—\iÚ×–j&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;1&nbsp;</td>
<td valign="TOP">&nbsp;CuÌÄpÉ—\iÚ×–j&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;2&nbsp;</td>
<td valign="TOP">&nbsp;CuÌI&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;3&nbsp;</td>
<td valign="TOP">&nbsp;\iÚ×–j&nbsp;</td>
</tr>
</table>
</div>
<br>
<br>
<div style="margin-left:67px;">Ì‚SÂ‚ÌƒGgÍAYÖê‡É‚Í‚ÌŠÖo^Aê‡É‚ÍAÉ’PÉƒ^[Öo^È‚Î‚È‚Ü‚B<br></div>

<div style="margin-left:40px;"><h4><b>I</b><br></h4></div>

<div style="margin-left:67px;">CuÌIÖÍAÈ‰prototypeÜ‚B<br></div>
        <div style="margin-left:80px;"><pre><font size=3>	void  lib_terminate(int mode);
</pre></font></div>
<div style="margin-left:67px;">modeÉ‚AIÖÄ‚Ñowè‚³Ü‚B<br><br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>mode</b>&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b></b>&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;0&nbsp;</td>
<td valign="TOP">&nbsp;VXeIirebootj&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;1&nbsp;</td>
<td valign="TOP">&nbsp;W[íœiİ–A\j&nbsp;</td>
</tr>
</table>
</div>
<br>
<br>
<div style="margin-left:67px;">rebootÌ‚ß‚ÌIÖÌŒÄ‚ÑoÍAÊAVXeèİ‹Ö~É‚ÅsÜ‚BAèİ‹Ö~Ô‚Å‚ÍIsÅ‚È‚í’“Cuè‚¤é‚½ßAç‚©SetRebootTimeLibraryHandlingMode() ÖpÄAIÖÌŒÄ‚Ño^C~Oí’“CuÆ‚Éİ’è‚µÄ‚Æ‚Å‚Ü‚Bİ’Å‚^C~OÍˆÈ‰3Æ‚Å‚B<br></div>
    <div style="margin-left:65px;"><ol TYPE="a">
         <li VALUE=1> èİ‹Ö~É‚ÉŒÄ‚ÑoiftHgj</li>
         <li VALUE=2> èİ‹Ö~É‚OÉŒÄ‚Ño</li>
         <li VALUE=3> èİ‹Ö~É‚OÆ‹Ö~É‚É‚ê‚¼PÄ‚Ño</li>
</ol></div>
</ul></div>

<div style="margin-left:40px;"><h4><b>CuGg`t@CÌ—</b><br></h4></div>

        <div style="margin-left:80px;"><pre><font size=3># Ü‚ÅÉƒCuéŒ¾BÌ—Å‚ 'mylib' ÆéŒ¾B
Libname mylib
# versionÌéŒ¾B
Version 1.1
# ========= í’“CuÌŠeGgÌéŒ¾ =============
# KÉ‚ÅÌlÂ‚ÌƒGgÍƒVXepÉƒU[uÄ‚
# PÔ–Ú‚ÍACuÌpÉ—\iÚ×–j
# QÔ–Ú‚ÍACuÌÄpÉ—\iÚ×–j
# RÔ–Ú‚ÍAÎAIGg
# SÔ–Ú‚ÍA\
Entry -
Entry -
Entry -
Entry -
Entry AllocMemory
Entry ReAllocMemory
# OÄ‚Ô‚Æ‚ÌŠÖÆAÛ‚ÌŠÖÍˆÈ‰Ì‚æ‚¤ÉˆÙ‚Ä‚Ä‚æ‚¢
# 	O		
Entry FreeMemory		mylib_free_memory
</pre></font></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_5_3">
<a href="#Heading3_5"> 5. </a>3 <b>Ä‚Ñoe[u\</b><br>
</a>
</h3>
<div style="margin-left:50px;">í’“CugpvOÅ•KvÈŒÄ‚Ñoe[u\Ì‚ÍAÊioplibld[eBeBpÄì¬Ü‚B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_5_4">
<a href="#Heading3_5"> 5. </a>4 <b>XPg</b><br>
</a>
</h3>
<div style="margin-left:50px;">í’“Cuì¬é‚½ß‚ÌQlÆ‚ÄACuGg`t@CiGge[u\ÌjÆƒvOÌƒXPgÜ‚BvOÌƒXPgÍAÊÌí’“CuÆƒA[hÂ”\Èí’“CuÆ‚É‚Â‚Ä‚ê‚¼ê¦Ä‚Ü‚B<br></div>

<div style="margin-left:40px;"><h4><b>CuGg`t@CÌƒXPg</b><br></h4></div>

        <div style="margin-left:80px;"><pre><font size=3>Libname mylib
Version 1.1
Entry	-
Entry	-
Entry	-
Entry	-
Entry	libentry1
Entry	libentry2
</pre></font></div>

<div style="margin-left:40px;"><h4><b>í’“CuÌƒvOÌƒXPg</b><br></h4></div>

        <div style="margin-left:80px;"><pre><font size=3>#include &lt;kernel.h&gt;

int start(int argc, char *argv[])
{
	extern libhead mylib_entry;

	/* W[Ìí’“É•KvÈÈ‚Ç‚sB*/
	if( És ) {
		/* KvÈ‚ÎAÌƒLZs */
		return NO_RESIDENT_END;
	}

	/* gÌƒGge[uVXeÉ“o^B */
	if( RegisterLibraryEntries(&mylib_entry) == KE_OK )
		return RESIDENT_END;
	else {
		/* KvÈ‚ÎAÌƒLZs */
		return NO_RESIDENT_END;
	}
}

int libentry1()
{
  /* .... */
}

int libentry2()
{
  /* .... */
}
</pre></font></div>

<div style="margin-left:40px;"><h4><b>A[hÂ”\í’“CuÌƒvOÌƒXPg</b><br></h4></div>

        <div style="margin-left:80px;"><pre><font size=3>#include &lt;kernel.h&gt;

int module_start(int argc, char *argv[]) {
	extern libhead mylib_entry;

	/* W[Ìí’“É•KvÈÈ‚Ç‚sB*/
	if( És ) {
		/* KvÈ‚ÎAÌƒLZs */
		return NO_RESIDENT_END;
	}

	/* gÌƒGge[uVXeÉ“o^B */
	if( RegisterLibraryEntries(&mylib_entry) == KE_OK )
		return REMOVAL_RESIDENT_END;
	else {
		 /* KvÈ‚ÎAÌƒLZs */
		return NO_RESIDENT_END;
    }
}

int module_stop(int argc, char *argv[]) {
	/* gÌƒGge[uVXeç–•B */
	ReleaseLibraryEntries(&mylib_entry);

	/* W[ÌíœOÉ•KvÈIÈ‚Ç‚sB*/
	if( IÉ )
		return NO_RESIDENT_END;
	else {
		/* Â”\È‚ÎAIÌƒLZsA
		* í’“ğ‘±sÅ‚æ‚¤ÈÔ‚É–ß‚B
		* KvÈ‚ÎgÌƒGge[uÌÄ“o^s
		*/
		return REMOVABLE_RESIDENT_END;
	}
}
</pre></font></div>
<div style="margin-left:50px;"><br></div>
        <div style="margin-left:80px;"><pre><font size=3>int start(int argc, char *argv[]) {
	if( argc &gt;= 0 )    return module_start(argc, argv);
	else               return module_stop(-argc, argv);
}
</pre></font></div>
<div style="margin-left:50px;"><br></div>
        <div style="margin-left:80px;"><pre><font size=3>int libentry1()
{
  /* .... */
}

int libentry2()
{
  /* .... */
}

</pre></font></div>

<!-- o@RCßŒo -->
<a name="Heading3_6">
<h2>
 6 <b>RpCÌè‡</b>
<hr noshade>
</h2>


<!-- o@SCo -->
<h3>
<a name="Heading4_6_1">
<a href="#Heading3_6"> 6. </a>1 <b>P[^uvOÌƒRpC</b><br>
</a>
</h3>
<div style="margin-left:50px;">P[^uvOì¬é‚½ß‚É‚ÍA`IÈƒRpCENè‡ÌÅŒÌ’iKÅƒvOÌƒAhXè‚·ÉAJÌƒp[VN@\ÅƒIuWFNgĞ‚Æ‚Â‚É‚Ü‚Æ‚ßAiopfixup[eBeBpIOPP[^us`Ö•ÏŠÆ‚è‡ğ“¥‚İ‚Ü‚B<br></div>
<div style="margin-left:50px;"></div>
<div style="margin-left:67px;">
<p>
<img src="gif/iop_prog006.gif"><p>

</div>
<br>

<div style="margin-left:40px;"><h4><b>P[^uvOÌƒRpCè‡Ì—</b><br></h4></div>

<div style="margin-left:67px;">P[^uvORpCè‡ÍAÆ‚ÎÌ‚æ‚¤É‚È‚Ü‚B<br></div>
        <div style="margin-left:80px;"><pre><font size=3>$ iop-gcc -c xxx1.c
$ iop-gcc -c xxx2.c
$ iop-ld -r -dc -o xxxx.o xxx1.o xxx2.o -lyyy
$ iopfixup -o xxxx.irx xxxx.o
</pre></font></div>
<div style="margin-left:50px;"><br></div>
<div style="margin-left:67px;">LÆŠÈ’PÉÏ‚Ü‚É‚ÍÌ‚æ‚¤É‚Ü‚B<br></div>
        <div style="margin-left:80px;"><pre><font size=3>$ iop-gcc -c xxx1.c
$ iop-gcc -c xxx2.c
$ iop-gcc -o xyz.irx xxx1.o xxx2.o -lyyy
</pre></font></div>
<div style="margin-left:50px;"><br></div>
<div style="margin-left:67px;">ÉŠÈ’PÉ‚ÆAÌ‚PR}hÅÏ‚Ü‚é‚±Æ‚Å‚Ü‚B<br></div>
        <div style="margin-left:80px;"><pre><font size=3>$ iop-gcc -o xyz.irx xxx1.c xxx2.c -lyyy
</pre></font></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_6_2">
<a href="#Heading3_6"> 6. </a>2 <b>í’“CuÌƒRpC</b><br>
</a>
</h3>
<div style="margin-left:50px;">í’“CuÆ‚ÍAvOR[hÌˆê•”ğ‘¼‚ÌƒW[Tu[`Æ‚ÄŒÄ‚Ñoæ‚¤É’ñ‹Ÿ‚Ä‚éƒ‚W[Å‚B<br>í’“CuÉ‚Í‚ÌƒW[Ç‚Ì‚æ‚¤ÈƒTu[`ñ‹Ÿ‚é‚©Gge[u\Ì‚KvÅ‚BÜ‚Aí’“Cuñ‹Ÿ‚Tu[`ğ—˜—péƒ‚W[É‚ÍAÇ‚ÌƒW[Ì‚Ç‚ÌƒTu[`ğ—˜—pé‚©Ä‚Ñoe[u\Ì‚KvÅ‚BÌ\Ì‚ğ¶Né‚½ß‚ÉAioplibgen[eBeBioplibld[eBeBpÓ‚Ä‚Ü‚B<br>í’“CuÆAí’“Cuğ—˜—péƒ‚W[ÌƒRpCENÌè‡Í‰}Ì‚æ‚¤É‚È‚Ü‚B<br></div>
<div style="margin-left:50px;"></div>
<div style="margin-left:67px;">
<p>
<img src="gif/iop_prog007.gif"><p>

</div>
<br>

<div style="margin-left:40px;"><h4><b>í’“CuW[ÌƒRpCè‡</b><br></h4></div>

        <div style="margin-left:80px;"><pre><font size=3>$ ioplibgen -d stubs.ilb -e entry.s entry.tbl
$ iop-as -o entry.o entry.s 
$ iop-gcc -c lll1.c
$ iop-gcc -c lll2.c
$ iop-ld -r -dc -o lmn.o lll1.o lll2.o entry.o
$ iopfixup -o lnm.irx lnm.o
</pre></font></div>

<div style="margin-left:40px;"><h4><b>í’“Cuğ—˜—péƒ‚W[ÌƒRpCè‡</b><br></h4></div>

<div style="margin-left:67px;">(a)X^eBbNCuNÈ‚ê‡<br></div>
        <div style="margin-left:80px;"><pre><font size=3>$ iop-gcc -c xxx1.c
$ iop-gcc -c xxx2.c
$ ioplibld -s stub.s xxx1.o xxx2.o : stubs.ilb
$ io-as -o stubs.o stubs.s
$ iop-ld -r -dc -o xyz.o xxx1.o xxx2.o stubs.o
$ iopfixup -o xyz.irx xyz.o
</pre></font></div>
<div style="margin-left:67px;">ÆŠÈ’PÉÏ‚Ü‚É‚Ícc<br></div>
        <div style="margin-left:80px;"><pre><font size=3>$ iop-gcc -c xxx1.c
$ iop-gcc -c xxx2.c
$ iop-gcc -o xyz.irx xxx1.o xxx2.o -ilb=stubs.ilb
</pre></font></div>
<div style="margin-left:67px;">(b)X^eBbNCuNê‡<br></div>
        <div style="margin-left:80px;"><pre><font size=3>$ iop-gcc -c xxx1.c
$ iop-gcc -c xxx2.c
$ ioplibld -s stub.s xxxall.o xxx1.o xxx2.o -lsss : stubs.ilb
$ io-as -o stubs.o stubs.s
$ iop-ld -r -dc -o xyz.o xxx1.o xxx2.o stubs.o -lsss
$ iopfixup -o xyz.irx xyz.o
</pre></font></div>
<div style="margin-left:67px;">ÆŠÈ’PÉÏ‚Ü‚É‚Ícc<br></div>
        <div style="margin-left:80px;"><pre><font size=3>$ iop-gcc -c xxx1.c
$ iop-gcc -c xxx2.c
$ iop-gcc -o xyz.irx xxx1.o xxx2.o -lsss -ilb=stubs.ilb
</pre></font></div>
<div style="margin-left:50px;"><br></div>
<div style="margin-left:67px;">È‚AIOP kernelÌ‚Ì‚Ìí’“CuW[\Ä‚Ü‚BÌ‚ß‚×‚Ä‚ÌƒAvP[VvOÍAÈ‚ç‚¸uí’“Cuğ—˜—péƒ‚W[vÆ‚Äé‚±Æ‚É‚È‚Ü‚B<br></div>

<!-- o@RCßŒo -->
<a name="Heading3_7">
<h2>
 7 <b>QlFW[ÔƒNÌdg</b>
<hr noshade>
</h2>

<div style="margin-left:50px;">IOPvO[_ÍƒW[Ìƒ[hÉŠYW[Ìƒ[hÏƒW[ií’“CujÄ‚ÑoÄ‚é‚©Ç‚AKvÈê‡ÌƒW[Æ‚ÌƒNsÜ‚BÌƒN@\ÍAÄ‚Ñoí’“CuÌƒGge[u\Ì‚ÆŒÄ‚ÑoW[ÌŒÄ‚Ñoe[u\Ì‚ğ‘€ì‚·é‚±Æ‚ÅsÜ‚B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_7_1">
<a href="#Heading3_7"> 7. </a>1 <b>Gge[u\</b><br>
</a>
</h3>
<div style="margin-left:50px;">í’“CuÌƒW[É’ñ‹Ÿ‚ÖQÍAÈ‰ÉGge[u\Ì‚Å‹LqAW[Ì‹NÉƒW[gÉ‚ÄƒvO[_API RegisterLibraryEntries()gpÄƒVXeÉ“o^Ü‚B<br>Ğ‚Æ‚Â‚ÌƒW[o^Å‚Gge[u\Ì‚ÌÉÍ‚Ü‚BÂ‚Ü‚AĞ‚Æ‚Â‚ÌƒW[ÌƒCuo^é‚±Æ‚Å‚Ü‚B<br></div>

<div style="margin-left:40px;"><h4><b>Gge[u\Ì‚ÌŒ`</b><br></h4></div>

<div style="margin-left:67px;">Gge[u\Ì‚ÍÌŒ`Ü‚B<br><br></div>
        <div style="margin-left:80px;"><pre><font size=3>	.text
	.set noreorder
	.globl  mylib_entry
mylib_entry:
	.word  0x41c00000	/* magic number of entry table */
	.word  0		/* reserved */
	.short  0x0101		/* version */
	.short  0x0000		/* flags */
	.ascii  "mylib\0\0\0"	/* library name (max 8 characters) */
	.align  2

	.word		MylibEntry1	/* address of function 1 */
	.word		MylibEntry2	/* address of function 2 */
	.word		MylibEntry3	/* address of function 3 */
	.word		MylibEntry4	/* address of function 4 */
	:
	:
	.word  0		/* table end mark */
</pre></font></div>
<div style="margin-left:67px;"><br>qÌ—\GgÌ‹KÉ‚AGgÖÍ‚SÂˆÈo^Ä‚È‚Î‚È‚Ü‚B<br>'flags'ÌƒtB[hÍAİ‚ÍAIOPVXeGge[uÌŠÇ—ÉgptB[hÅ‚BÈ‚ç‚¸0Ä‚B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_7_2">
<a href="#Heading3_7"> 7. </a>2 <b>Ä‚Ñoe[u\</b><br>
</a>
</h3>
<div style="margin-left:50px;">Ä‚Ñoe[u\Ì‚ÍAéƒ‚W[Ìí’“CuW[ñ‹Ÿ‚Ä‚Ögpé‚±Æ‚\\Ì‚Å‚B`ÍƒGge[u\Ì‚ÆÄ‚Ü‚AÌƒW[KvÆ‚Öe[uÉŠÜ‚İ‚Ü‚B<br>IOPvO[_ÍAW[Ìƒ[hÉŒÄ‚Ñoe[u\Ì’jumpß‚ÄƒW[Ô‚ÌƒNsÜ‚B<br></div>

<div style="margin-left:40px;"><h4><b>Ä‚Ñoe[u\Ì‚ÌŒ`</b><br></h4></div>

        <div style="margin-left:80px;"><pre><font size=3>	.text
	.set noreorder
	.globl  mylib_stub
mylib_stub:
	.word  0x41e00000	/* magic number of call table */
	.word  0			/* reserved */
	.short  0x0101		/* version */
	.short  0x0000		/* flags */
	.ascii  "mylib\0\0\0"	/* library name (max 8 characters) */
	.align  2

	.globl          MylibEntry1
MylibEntry1:
	j      $31
	.half   0		/* entry table index */
	.half   0x2400	/* index magic : 0x2400XXXX == addiu $0,$0,XXXX */

	.globl		MylibEntry2
MylibEntry2:
	j      $31
	.half   2		/* entry table index */
	.half   0x2400	/* index magic */
	:
	:
	:
	.word   0, 0	/* table end mark */
</pre></font></div>
<div style="margin-left:50px;"><br></div>
<div style="margin-left:67px;">Ä‚ÑoÖGgĞ‚Æ‚Â‚Ü‚Ü‚È‚Ä‚Ñoe[u\Ì‚Í‹Ü‚B<br>'flags' ÌƒtB[hÍAİ‚ÍAIOPVXeÄ‚Ñoe[uÌŠÇ—Ì‚ß‚ÉgptB[hÅ‚BÈ‚ç‚¸0Ä‚B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_7_3">
<a href="#Heading3_7"> 7. </a>3 <b>ilbt@CtH[}bg</b><br>
</a>
</h3>
<div style="margin-left:50px;">í’“Cuì¬ê‡ACuÆƒCuo[WAÑƒCuÌŠeÖÌ–OÆƒe[uCfbNXÌ‘Î‰Lqf[^t@Ciilbt@Cjì¬KvÜ‚B<br>Ìƒt@CÍƒCuğ—˜—pé‘¤ÌƒW[ÌƒNÉAÄ‚Ñoe[u\Ì‚ì¬é‚½ß‚ÌÆ‚Ä—pÜ‚B<br>È‰Ì‚æ‚¤ÉŒÅ’`ÌƒeLXgt@CÆ‚Af[^t@CÌŠgq '.ilb' Æ‚Ü‚B<br><br></div>
        <div style="margin-left:80px;"><pre><font size=3>#IOP-ILB# CÓ‚Ì• 
L Cu 
V 0xHHHH 
F 0xHHHH
E ddd entryname 
E ddd entryname 
E ddd entryname 
</pre></font></div>
<div style="margin-left:50px;"><br>Å '#IOP-ILB#'ÅnÜ‚sÍ‘eLXgsilb-data`Å‚é‚±Æ‚éŒ¾Ü‚B<br>'L' ÅnÜ‚sÍ•K2sÚ‚ÉˆÊ’u,3Ú‚sÜ‚8È“ÌƒCu<br>'V' ÅnÜ‚sÍ•K3sÚ‚ÉˆÊ’u,5Ú‚416i<br>'F' ÅnÜ‚sÍ•K4sÚ‚ÉˆÊ’u,5Ú‚416i0wè‚µÜ‚B<br>5sÚˆÈ~'E'ÅnÜ‚3Ú‚310iÆA7Ú‚sÜ‚Å‚ÌƒGg<br><br>ilb-data`Ä‚Ğ‚Æ‚Â‚Ìƒt@CÉŠi[Ä‚æ‚¢Ì‚Æ‚Ü‚BÌê‡'#IOP-ILB#'Ø‚LÆ‚İ‚È‚Ü‚B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_7_4">
<a href="#Heading3_7"> 7. </a>4 <b>NÌŒİŠ`FbN</b><br>
</a>
</h3>
<div style="margin-left:50px;">OqÌ‚æ‚¤ÉƒGge[u\Ì‚ÆŒÄ‚Ñoe[u\Ì‚É‚library nametB[hversiontB[hÜ‚B<br>library nametB[h8byteÌƒTCYA8byteÉ–È‚OÌê‡nullÅƒpfBOÄ‚B<br>versiontB[hÌ8bitÍACuÌƒW[o[Wİ’è‚µA8bitÍA}Ci[o[Wİ’è‚µÜ‚B<br>versiontB[hÌİ’ÍA{IÉ‚ÍƒvO}É”CÄ‚Ü‚AÌ‹Kè‚ªÜ‚B<br>W[o[WÍAÖe[uÌ•ÑAyÑŠÖÌdlÉŒİŠÌ‚ê‡Alæ‚¤Éİ’è‚µÈ‚Î‚Ü‚B<br>}Ci[o[WÍAoOtBbNXİŠÛ‚@\Ç‰sê‚½Æ‚ÉXVÜ‚B<br>W[o[WA}Ci[o[WÆ‚A1ÈÌ’lpÜ‚B0ÍgpÈ‚Å‚B<br><br>W[IOPÉƒ[hÄAÉŠÜ‚Ü‚Ä‚Ñoe[u\Ì‚NÆ‚É‚ÍAlibrary nametB[hÆAW[o[Wvo^Ï‚ÌƒGge[u\Ì‚AÂ‚ÆƒNÜ‚B<br>iÓF2000N4İAvO[_ÍLÌ‚æ‚¤É“ì‚µÜ‚AÄ‚Ñoe[u\Ì‚Ìwè‚·}Ci[o[W}Ci[o[WÌƒGge[u\Ì‚Æ‚ÍƒNoÈ‚]Ü‚Ì‚ÅAê‚»Ì‚æ‚¤É•ÏX\Å‚Bj<br><br>Gge[u\Ì‚ÌƒVXeÖ‚Ì“o^ÍAÉ“o^Ä‚éƒ‰Culibrary nameÆƒW[o[WvÄA}Ci[o[Wå‚«Ì‚İ‚ê‡ÍAo^ÉsÜ‚B<br></div>

<!-- o@RCßŒo -->
<a name="Heading3_8">
<h2>
 8 <b>QlFIOPIuWFNgtH[}bg</b>
<hr noshade>
</h2>

<div style="margin-left:50px;">IOPIuWFNgtH[}bgÍAMIPS R3000ELF`P[^ut@CtH[}bgÉáŠ±Ì’Ç‰EÏXEÌ‚Å‚B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_8_1">
<a href="#Heading3_8"> 8. </a>1 <b>IOPW[ZNV</b><br>
</a>
</h3>
<div style="margin-left:50px;">IOPIuWFNgtH[}bgÉ‚ÍAIOPW[ZNVVKÉ’Ç‰Ü‚B<br>IOPW[ZNVÍˆÈ‰Ì\Ì‰Â•Ï’Ìƒf[^AIOPvO[_W[[hÉsÉ•KvÈİ’è‚µÜ‚B<br><br></div>
        <div style="margin-left:80px;"><pre><font size=3>/* A section of type SHT_SCE_IOPMOD contains the following structure.  */
typedef struct _Elf32_IopMod {
	Elf32_Word	moduleinfo;
	Elf32_Word	entry;
	Elf32_Word	gp_value;
	Elf32_Word	text_size;
	Elf32_Word	data_size;
	Elf32_Word	bss_size;
	Elf32_Half	moduleversion;
	char		modulename[1];	/* null terminate */
} Elf32_IopMod;
</pre></font></div>
<div style="margin-left:50px;"><br>entryÍAvOÌ‹NGgAhXTEXT segmentæ“ªÌƒItZbgÜ‚B<br>gp_valueÍAvOGP registerÌ’lTEXT segmentæ“ªÌƒItZbgÜ‚B<br>text_size, data_size, bss_sizeÍ‚ê‚¼TEXT, DATA, BSS segmentÌƒTCYÜ‚B<br>vODATA segmentModuleInfo\Ì‚ModuleÏİ‚Æ‚ÍAmoduleinfoModuleÏTEXT segmentæ“ªÌƒItZbgAÉAmoduleversionModule.versionÌƒRs[Amodulename[]É‚ÍAModule.nameÌƒRs[i[Ü‚B<br>ModuleÏİ‚È‚Æ‚ÍAmoduleinfoÉ‚0xffffffffAmoduleversionmodulename[0]É‚ÍA0Ü‚B<br><br>IOPW[ZNVÌƒZNV ".iopmod"Æ‚È‚AZNVwb_ÌŠetB[hÉ‚ÍˆÈ‰Ì’li[Ü‚B<br><br></div>
<div style="margin-left:90px;">
<table border=0>
<tr>
<td valign="TOP">&nbsp;sh_type&nbsp;</td>
<td valign="TOP">&nbsp;=  SHT_SCE_IOPMOD(=0x70000080)&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;sh_offset&nbsp;</td>
<td valign="TOP">&nbsp;=  ZNVf[^Ìƒt@Cæ“ªÌƒItZbg&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;sh_size&nbsp;</td>
<td valign="TOP">&nbsp;=  sizeof(Elf32_IopMod)+strlen(Elf32_IopMod.modulename)&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;sh_addralign&nbsp;</td>
<td valign="TOP">&nbsp;=  4&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;Ì‘&nbsp;</td>
<td valign="TOP">&nbsp;=  0&nbsp;</td>
</tr>
</table>
</div>
<br>
<div style="margin-left:50px;">È‚AIOPIuWFNgt@CÉ‚ .reginfoZNVÍ•svÅ‚B<br>.reginfoZNVÍ“È‚Å‚B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_8_2">
<a href="#Heading3_8"> 8. </a>2 <b>t@CÌƒf[^CAEg</b><br>
</a>
</h3>
<div style="margin-left:50px;">WELF`P[^ut@CÅ‚Íƒt@CÌƒf[^Ì”zuÍ‚Æ‚É‹Kè‚³Ä‚Ü‚ñ‚ªAIOPIuWFNgtH[}bgÅ‚ÍˆÈ‰ÌÉƒf[^Å‚È‚Î‚Ü‚B<br></div>
    <div style="margin-left:55px;"><ol>
         <li VALUE=1> ELFwb_</li>
         <li VALUE=2> vOwb_e[u</li>
         <li VALUE=3> IOPW[ZNVf[^</li>
         <li VALUE=4> TEXT, DATA segmentf[^</li>
         <li VALUE=5> Ì‘ÌƒZNVf[^</li>
         <li VALUE=6> ZNVwb_e[u</li>
         <li VALUE=7> TEXT, DATA segmentÌƒP[Ve[uf[^</li>
         <li VALUE=8> Ì‘ÌƒZNVf[^</li>
</ol></div>
</ul></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_8_3">
<a href="#Heading3_8"> 8. </a>3 <b>Ìƒf[^CAEg</b><br>
</a>
</h3>
<div style="margin-left:50px;">IOPW[Íu2.W[\vÌuZOgÌ”zuvÅq×‚æ‚¤ÉƒCAEgÄ‚KvÜ‚B<br>È‚í‚¿ATEXT, DATA, BSSeZOgÍ‚ÌÅ˜AÄ”zualign0x10AÂ‚Ü‚16byteEÅ‚È‚Î‚È‚Ü‚B<br><br>UNIXÈ‚Ç‚Å‚ÍA.rodataZNVÌ‚æ‚¤ÈsÂ‚Ìƒf[^TEXT segmentÉŠÜ‚Ü‚é‚±Æ‚Ü‚AIOPÌƒIuWFNgt@CÅ‚Í‚Í‹Ü‚B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_8_4">
<a href="#Heading3_8"> 8. </a>4 <b>ELFwb_ÌÚ</b><br>
</a>
</h3>
<div style="margin-left:50px;">ELFwb_Ì“eÍAÈ‰Ì‚æ‚¤Éİ’è‚³È‚Î‚È‚Ü‚B<br><br></div>
<div style="margin-left:67px;">e_ident	== 'ELF', ELFCLASS32, ELFDATA2LSB,  EV_CURRENT<br>e_type	== ET_SCE_IOPRELEXEC (==0xFF80)Ü‚ET_SCE_IOPRELEXEC2 (==0xFF81)<br>e_machine  == EM_MIPS<br>e_version  == EV_CURRENT<br>e_flags	== CÓij<br>e_entry	== vOÌ‹NGgAhXTEXT segmentæ“ªÌƒItZbg<br>	(Elf32_IopMod.entryÆ“l)<br>e_ehsize	== sizeof(Elf32_Ehdr)<br>e_phoff	== vOwb_e[uÌƒt@CÌˆÊ’u<br>	( sizeof(Elf32_Ehdr)Æ“É‚È‚)<br>e_phentsize  == sizeof(Elf32_Phdr)<br>e_phnum  == 2<br>e_shoff	== ZNVwb_e[uÌƒt@CÌˆÊ’u<br>e_shentsize  == sizeof(Elf32_Shdr)<br>e_shnum  == t@CÌƒZNVÌ<br>e_shstrndx  == .shstrtabZNVÌƒZNVCfbNX<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_8_5">
<a href="#Heading3_8"> 8. </a>5 <b>vOwb_e[uÌÚ</b><br>
</a>
</h3>
<div style="margin-left:50px;">vOwb_e[uÍ•KQÂ‚Ì—vfAÈ‰ÌÉ‚È‚Ä‚Ü‚B<br></div>

<div style="margin-left:40px;"><h4><b>IOP Module Header</b><br></h4></div>

<div style="margin-left:90px;">
<table border=0>
<tr>
<td valign="top">&nbsp;p_type&nbsp;</td>
<td valign="top">&nbsp;== PT_SCE_IOPMOD( == 0x70000080)&nbsp;</td>
</tr>
<tr>
<td valign="top">&nbsp;p_flags&nbsp;</td>
<td valign="top">&nbsp;== PF_R&nbsp;</td>
</tr>
<tr>
<td valign="top">&nbsp;p_offset&nbsp;</td>
<td valign="top">&nbsp;== IOPW[ZNVÌƒf[^Ìƒt@CÌˆÊ’u&nbsp;</td>
</tr>
<tr>
<td valign="top">&nbsp;p_filesz&nbsp;</td>
<td valign="top">&nbsp;== IOPW[ZNVÌƒf[^ÌƒTCY&nbsp;</td>
</tr>
<tr>
<td valign="top">&nbsp;&nbsp;&nbsp;</td>
<td valign="top">&nbsp;sizeof(Elf32_IopMod)+strlen(Elf32_IopMod.modulename)&nbsp;</td>
</tr>
<tr>
<td colspan= 2  valign="top">&nbsp;p_vaddr,p_memsz  == 0&nbsp;</td>
</tr>
<tr>
<td valign="top">&nbsp;p_align&nbsp;</td>
<td valign="top">&nbsp;== 4&nbsp;</td>
</tr></table>
</div>

<div style="margin-left:40px;"><h4><b>Segment Header</b><br></h4></div>

<div style="margin-left:90px;">
<table border=0>
<tr>
<td valign="TOP">&nbsp;p_type&nbsp;</td>
<td valign="TOP">&nbsp;== PT_LOAD&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;p_flags&nbsp;</td>
<td valign="TOP">&nbsp;== PF_R+PF_W+PF_X&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;p_offset&nbsp;</td>
<td valign="TOP">&nbsp;== TEXT segment f[^Ìƒt@CÌˆÊ’u&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;p_vaddr&nbsp;</td>
<td valign="TOP">&nbsp;== 0&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;p_filesz&nbsp;</td>
<td valign="TOP">&nbsp;== t@CÌƒ[hf[^ÌƒTCY&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;(TEXT segment size + DATA segment size)&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;p_memsz&nbsp;</td>
<td valign="TOP">&nbsp;== Éƒ[hÌƒf[^TCY&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;(TEXT segment size + DATA segment size + BSS segment size)&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;p_align&nbsp;</td>
<td valign="TOP">&nbsp;== 0x10&nbsp;</td>
</tr>
</table>
</div>

<!-- o@SCo -->
<h3>
<a name="Heading4_8_6">
<a href="#Heading3_8"> 8. </a>6 <b>\V{</b><br>
</a>
</h3>
<div style="margin-left:50px;">SCEIOPIuWFNgt@CWFl[^iopfixupÅ‚ÍAÈ‰Ì—\V{Ü‚B<br><br></div>
<div style="margin-left:90px;">
<table border=0>
<tr>
<td valign="TOP">&nbsp;_ftext&nbsp;</td>
<td valign="TOP">&nbsp;TEXTZOgÌæ“ªAhX&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;_etext, etext&nbsp;</td>
<td valign="TOP">&nbsp;TEXTZOgÌÅŒbyteÌÌƒAhX&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;_fdata&nbsp;</td>
<td valign="TOP">&nbsp;DATAZOgÌæ“ªAhX&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;_edata, edata&nbsp;</td>
<td valign="TOP">&nbsp;DATAZOgÌÅŒbyteÌÌƒAhX&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;_fbss&nbsp;</td>
<td valign="TOP">&nbsp;BSSZOgÌæ“ªAhX&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;_end, end&nbsp;</td>
<td valign="TOP">&nbsp;BSSZOgÌÅŒbyteÌÌƒAhX&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;_gp&nbsp;</td>
<td valign="TOP">&nbsp;gpWX^Ìl&nbsp;</td>
</tr>
</table>
</div>
<br>
<div style="margin-left:50px;">LÌƒV{Ô‚Å‚ÍˆÈ‰ÌŠÖŒWè—§Ü‚B<br></div>
<div style="margin-left:67px;">0 &lt;= ( _fdata - _etext ) &lt; 0x10<br>0 &lt;= ( _fbss - _edata ) &lt; 0x10<br></div>
<div style="margin-left:50px;"><br>vOÌƒ\[XİŠmÛ‚é‚½ß‚ÉAJÜ‚IOPIuWFNgt@CWFl[^ÍALÌƒV{ğ¶é‚±Æ‚ğ„Ü‚B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_8_7">
<a href="#Heading3_8"> 8. </a>7 <b>V{e[uGg</b><br>
</a>
</h3>
<div style="margin-left:50px;">V{e[uÌƒe[uGgst_valuetB[hÌ•ÛlAhXÅ‚ê‡AÍƒZNVItZbgÅ‚Í‚È‚AvOItZbgiTEXT segmentÌæ“ªÌƒItZbgjÆ‚È‚Ü‚B<br><br>Ü‚ALÌ—\V{Ì‚Aetext, _etext, edata, _edata, _fbss,end, _end, _gpÌƒGgÍAst_shndxtB[hSHN_RADDR(==0xff1f)Ü‚B<br><br>ÈŠOÍAWR3000pELFP[^ut@CÆ“Å‚B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_8_8">
<a href="#Heading3_8"> 8. </a>8 <b>P[Ve[uGg</b><br>
</a>
</h3>
<div style="margin-left:50px;">P[Ve[uGgÉŠÖ‚ÄAÈ‰É‹LqÄ‚È‚Í•W R3000 p ELF P[^ut@CÆ“É‚È‚Ü‚B<br>P[Ve[uÌƒe[uGgr_offsettB[hÍAP[VÅ‚ÌKpZNVf[^[hÌˆÊ’uvOItZbgiTEXT segmentÌæ“ªÌƒItZbgji[Ar_symtB[h(==ELF_32_R_SYM(r_info))ÍSTN_UNDEFi[Ü‚B<br><br>ELFP[^ut@C IOP IuWFNgt@CÉ•ÏŠÛ‚ÉA r_sym tB[hÄ‚V{Ì’lvOItZbgÉ•ÏŠÌ‚AYZNVf[^ÌƒP[VtB[hÉ“KØ‚É‘Ü‚È‚Î‚È‚Ü‚B<br><br>Cu[X 2.5.2 È‘O IOPÌƒvO[_Å‚ÍAELF wb_ e_type  ET_SCE_IOPRELEXEC  IOP IuWFNgt@CÌ‚İ‚[hÂ”\Å‚B<br>ÌƒIuWFNgt@CÅ‹éƒŠP[V^CvÍˆÈ‰ 6 ^CvÅ‚B<br><br></div>
<div style="margin-left:67px;">R_MIPS_NONE<br>R_MIPS_16<br>R_MIPS_32<br>R_MIPS_26<br>R_MIPS_HI16<br>R_MIPS_LO16<br><br></div>
<div style="margin-left:50px;">e[u R_MIPS_HI16 ÌÉ‚Í•KÎ‰ R_MIPS_LO16Î‚È‚Ü‚B R_MIPS_LO16 Í’PÆ‚Å‘İ‚é‚±Æ‚Í‹Ü‚B<br>Cu[X 2.5.3 È~ IOPÌƒvO[_ÍA@\gÄAL IOP IuWFNgt@CÉ‰ ELF wb_ e_type ET_SCE_IOPRELEXEC2  IOP IuWFNgt@C[hé‚±Æ‚Å‚Ü‚B<br>ÌƒIuWFNgt@CÅ‹éƒŠP[V^CvÍˆÈ‰ 8 ^CvÅ‚B<br><br></div>
<div style="margin-left:67px;">R_MIPS_NONE<br>R_MIPS_16<br>R_MIPS_32<br>R_MIPS_26<br>R_MIPS_HI16<br>R_MIPS_LO16<br>R_MIPSSCE_MHI16(=0xfa)<br>R_MIPSSCE_ADDEND(=0xfb)<br></div>
<div style="margin-left:50px;"><br>e[u R_MIPS_HI16 ÌÉ‚Í•KÎ‰ R_MIPS_LO16Î‚È‚Ü‚BAR_MIPS_LO16 Í’PÆ‚Å‘İ‚é‚±Æ‚Ü‚B<br>GNU  binutil È‚Ç‚Å‚ÍAÌƒQÆ‚é•¡ R_MIPS_HI16 AAÌ’É‚É‘Î‰ R_MIPS_LO16Â’uIuWFNgt@Cğ¶é‚±Æ‚Ü‚B<br>Ì‚æ‚¤È˜A R_MIPS_HI16 R[hÍAe_type   ET_SCE_IOPRELEXEC2 IOP IuWFNgt@CÅ‚ÍAÈ‰Éq×‚ R_MIPSSCE_MHI16 R_MIPSSCE_ADDEND ÌƒyAÉ•ÏŠÈ‚Ä‚Í‚È‚Ü‚B<br>R_MIPSSCE_MHI16  R_MIPSSCE_ADDEND Í•KÌÅƒyAÅƒe[uÉ˜AÄŠi[È‚Î‚Ü‚B<br><br>R_MIPSSCE_ADDEND R[h r_offset tB[hÍAP[VÅ‰Z×‚(addend)ÛÄ‚Ü‚B<br>({ß‚ÌÅÅq×‚æ‚¤É‘Ìƒ^CvÌƒR[h r_offset tB[hÍAP[VÅ‚ÌKpZNVf[^[hÌˆÊ’uvOItZbgÛÄ‚Ü‚B<br>È‚í‚¿AR_MIPSSCE_ADDENDR[h r_offset tB[hÍ•Ï‘IÈgÄ‚Ü‚B)<br><br>W ELF ÌƒP[VR[hÆsZNVf[^Ìƒ[hÆ‚ÍˆÎˆÅ‘Î‰Ä‚Ü‚B<br>AR_MIPSSCE_MHI16 R[hÍAÌƒ^CvÌƒR[hÆ‚ÍˆÙ‚È‚Asé•¡Ìƒ[hÉ‘Î‰Ä‚Ü‚B<br>YÌƒ[hQÌ‚ê‚¼ÌƒP[VtB[h([hÌ‰16rbg)ÍA[hQÖ˜Até‚½ß‚Ì`XgÌƒNtB[hÆ‚Ä—pêŸÌƒ[hÖ‚Ìƒ[hPÊ‚Ì•tÎƒItZbgi[Ä‚Ü‚B<br>`XgÌ–[Å‚ÍAÎƒItZbgl 0 É‚È‚Ü‚B<br>R_MIPSSCE_MHI16 R[h r_offset tB[hÉ‚Í‚Ì`XgÌÅÌƒ[hwvOItZbg(TEXT segment Ìæ“ªÌƒItZbg)i[Ü‚B<br>(LÌƒP[VÌQlR[hQÆ‚Ä‚B)<br><br>Cu[X 2.5.2 È‘O IOPÌƒvO[_ÌƒP[VQlÌ‚ßˆÈ‰ÉÜ‚B<br></div>
        <div style="margin-left:80px;"><pre><font size=3>void OLD_apply_elf_rel_section(unsigned int textstart,Elf32_Rel *rp, int entrise)
	{
	@@int i, type, mhioff;
	@@unsigned int data, datalow, daddr, daddr1;

	@@for( i = 0; i &lt; entrise; i++, rp++ ) {
		@type = ELF32_R_TYPE(rp-&gt;r_info);
		@daddr = (unsigned int)(rp-&gt;r_offset + textstart);
		@switch( type ) {
		@case R_MIPS_NONE:
		@@break;
		@case R_MIPS_16:
		@@data = (unsigned int)( ((*(int *)daddr)&lt;&lt;16)&gt;&gt;16) + textstart;
		@@// if( (data&gt;&gt;16) != 0 && (data&gt;&gt;16) != 0xffff )
		@@//     panic("R_MIPS_16 data overflow\n");
		@@*(unsigned int *)daddr &= 0xffff0000;
		@@*(unsigned int *)daddr |= data&0xffff;
		@@break;
		@case R_MIPS_32:
		@@*(unsigned int *)(daddr) += textstart;
		@@break;
		@case R_MIPS_26:
		@@data = *(unsigned int *)daddr;
		@@data = (data & 0x03ffffff)&lt;&lt;2;
		@@data |= (daddr & 0xf0000000);
		@@data += textstart;
		@@*(unsigned int *)daddr &= 0xfc000000;
		@@*(unsigned int *)daddr |= (data&lt;&lt;4)&gt;&gt;6;
		@@break;
		@case R_MIPS_HI16:
		@@// if( i == entrise+1
		@@//     || ELF32_R_TYPE(rp[1].r_info) != R_MIPS_LO16
		@@//     || ELF32_R_SYM(rp[1].r_info) != SHN_UNDEF  ) {
		@@//     panic("R_MIPS_HI16 without R_MIPS_LO16\n");
		@@// }
		@@daddr1 = (unsigned int)( rp[1].r_offset + textstart );
		@@data  = (unsigned int)( (*(int *)daddr)&lt;&lt;16 );
		@@datalow = (unsigned int)( ((*(int *)daddr1)&lt;&lt;16)&gt;&gt;16 );
		@@data = data + datalow + textstart;
		@@*(unsigned int *)daddr  &= 0xffff0000;
		@@*(unsigned int *)daddr  |= (((data&gt;&gt;15)+1)&gt;&gt;1)&0xffff;
		@@*(unsigned int *)daddr1 &= 0xffff0000;
		@@*(unsigned int *)daddr1 |= data&0xffff;
		@@rp++; i++; /* skip R_MIPS_LO16 */
		@@break;
		@case R_MIPS_LO16:
		@@// panic("R_MIPS_LO16 without R_MIPS_HI16\n");
		@@break;
		@default:
		@@// panic("unacceptable relocation type: 0x%x\n", type);
		@@break;
		@}
	@@}
	}
</pre></font></div>
<div style="margin-left:50px;"><br>Cu[X 2.5.3 ÈŒ IOPÌƒvO[_ÌƒP[VÌŠTvQlÌ‚ßˆÈ‰ÉÜ‚B<br><br></div>
        <div style="margin-left:80px;"><pre><font size=3>void NEW_apply_elf_rel_section(unsigned int textstart, Elf32_Rel *rp, int entrise)
	{
	@@int i, type;
	@@unsigned int data, datalow, daddr, daddr1;

	@@for( i = 0; i &lt; entrise; i++, rp++ ) {
		@type = ELF32_R_TYPE(rp-&gt;r_info);
		@daddr = (unsigned int)(rp-&gt;r_offset+textstart);
		@switch( type ) {
		@// R_MIPS_NONE, R_MIPS_16, R_MIPS_32, R_MIPS_26 ÍˆÈ‘OÌƒo[W
		@//@Æ“Ì
		@case R_MIPS_HI16:
		@@// if( i == entrise+1
		@@//     || ELF32_R_TYPE(rp[1].r_info) != R_MIPS_LO16
		@@//     || ELF32_R_SYM(rp[1].r_info) != SHN_UNDEF  ) {
		@@//     panic("R_MIPS_HI16 without R_MIPS_LO16\n");
		@@// }
		@@data  = (unsigned int)( (*(int *)daddr)&lt;&lt;16 );
		@@daddr1 = (unsigned int)( rp[1].r_offset + textstart );
		@@datalow = (unsigned int)( ((*(int *)daddr1)&lt;&lt;16)&gt;&gt;16 );
		@@data = data + datalow + textstart;
		@@*(unsigned int *)daddr  &= 0xffff0000;
		@@*(unsigned int *)daddr  |= (((data&gt;&gt;15)+1)&gt;&gt;1)&0xffff;
		@@break;
		@case R_MIPS_LO16:
		@@data = (unsigned int)( ((*(int *)daddr)&lt;&lt;16)&gt;&gt;16) + textstart;
		@@*(unsigned int *)daddr &= 0xffff0000;
		@@*(unsigned int *)daddr |= data&0xffff;
		@@break;
		@case R_MIPSSCE_MHI16:
		@@// if( i == entrise+1
		@@//     || ELF32_R_TYPE(rp[1].r_info) != R_MIPSSCE_ADDEND
		@@//     || ELF32_R_SYM(rp[1].r_info) != SHN_UNDEF  ) {
		@@//     panic("R_MIPSSCE_MHI16 without R_MIPSSCE_ADDEND\n");
		@@// }
		@@data = rp[1].r_offset + textstart;
		@@data = (((data&gt;&gt;15)+1)&gt;&gt;1)&0xffff;
		@@do {
			mhioff = (((*(int *)daddr)&0xffff)&lt;&lt;16)&gt;&gt;14;
			*(unsigned int *)daddr  &= 0xffff0000;
			*(unsigned int *)daddr  |= data;
			daddr += mhioff;
		@@} while( mhioff != 0 );
		@@rp++; i++; /* skip R_MIPSSCE_ADDEND */
		@@break;
		@default:
		@@// panic("unacceptable relocation type: 0x%x\n", type);
		@@break;
		@}
	@@}
}
</pre></font></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_8_9">
<a href="#Heading3_8"> 8. </a>9 <b>fobO</b><br>
</a>
</h3>
<div style="margin-left:50px;">IOPIuWFNgtH[}bgÅ‚ÍAfobOÉŠÖ‚Ä‚Ì‹KÍsÜ‚B<br>Ü‚AIOPvO[_ÍA{Å‹Kè‚µÈŠOÌƒZNVğ–³Ü‚B<br>]ÄARpCx_Í“ÆÌƒfobOÜ‚ŞƒZNVIOPIuWFNgt@CÉŠÜ‚ß‚Ä‚Ü‚Ü‚B<br>ASCEÌƒ[eBeBÍASCEiop-gcciWR3000pgccÆ‚Ù‚Ú“jÌfobOñ‚ªƒZNV ".mdebug"ZNV^CvSHT_MIPS_DEBUGÅ‚é‚±Æ‚OÉ‚Ä‚Ì‚ÅAMIPSpgccÆ”İŠÌƒfobOğ¶ê‡ÍAÌƒZNVÜ‚ÍƒZNV^CvgpÄ‚Í‚Ü‚B<br><br></div>
<p><p><hr>
<div ALIGN="right">
    Copyright (c) 2002 Sony Computer Entertainment Inc.  All Rights Reserved.<br>
    SCE CONFIDENTIAL
</div>
</body>
</html>
