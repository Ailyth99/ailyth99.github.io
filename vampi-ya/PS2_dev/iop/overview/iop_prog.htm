<html lang="ja">
<!-- o@PCo -->
<head>

<script language="JavaScript">
<!--
  function startFixed(){
    fixedLAYER('fixedLay0','rightBottom',-35,-35)
  }

  var ie= !!document.all
  var n4= !!document.layers
  var w3c=!!document.getElementById
  var mac45 
    = navigator.userAgent.indexOf('MSIE 4.5; Mac_PowerPC')

  if(document.layers)window.onresize=resizeFunc
  function resizeFunc(e){location.reload()}

  function iniFunc(){
    if(ie&&!(mac45!=-1))window.onscroll = startFixed
    startFixed()
  }

  var tid=new Array()

  function fixedLAYER(layName,posString,offSetX,offSetY){

    offSetX = parseInt(offSetX,10)
    offSetY = parseInt(offSetY,10)

 if( posString == 'rightBottom' ){

      if(ie) offLeft = document.body.clientWidth   + offSetX
      else   offLeft = window.innerWidth           + offSetX
      if(ie) offTop  = document.body.clientHeight  + offSetY
      else   offTop  = window.innerHeight          + offSetY

    }
    else {

      if(ie) offLeft =                               offSetX
      else   offLeft =                               offSetX
      if(ie) offTop  =                               offSetY
      else   offTop  =                               offSetY

    }

    offLeft = parseInt(offLeft)
    offTop  = parseInt(offTop)

    if(document.all){
      var mx = parseInt(document.body.scrollLeft +offLeft)
      var my = parseInt(document.body.scrollTop  +offTop)
    } else {
      var mx = parseInt(self.pageXOffset+offLeft)
      var my = parseInt(self.pageYOffset+offTop)

    }

    moveLAYER(layName,mx,my)

    if(!(ie&&!(mac45!=-1)))
      setTimeout("fixedLAYER('"+layName+"','"+posString
                   +"','" +offSetX+"','"+offSetY+"')",100)
  }

  function moveLAYER(layName,x,y){
      
      if(document.getElementById){
        document.getElementById(layName).style.left=x
        document.getElementById(layName).style.top=y
      }
      else if(document.all){
        document.all(layName).style.pixelLeft=x
        document.all(layName).style.pixelTop=y
      }
      else if(document.layers)
        document.layers[layName].moveTo(x,y)
  }

// -->
</script>

<script language="JavaScript">
<!--
  function lj(ch,fm)
  {
    if ( parent.index ) {
      if ( ch == "libref" ){ parent.index.location.href="../libref/category.htm"; }
      else if ( ch == "../ee/libref" ){ parent.index.location.href="../../ee/libref/category.htm"; }
      else if ( ch == "../iop/libref" ){ parent.index.location.href="../../iop/libref/category.htm"; }
      else if ( ch == "../iop/overview" ){ parent.index.location.href="../../iop/overview/category.htm"; }
      else if ( ch == "../ee/overview" ){ parent.index.location.href="../../ee/overview/category.htm"; }
      else if ( ch == "overview" ){ parent.index.location.href="../overview/category.htm"; }
    }
    if ( parent.main ) {
      if ( fm != "" ){ parent.main.location.href=fm; }
    } else {
      if ( fm != "" ){ location.href=fm; }
    }
  }
//-->
</script>
<title>IOPvO~O</title>
<meta http-equiv="Content-Type"content= text/html; charset=UTF-8 >
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta name="Author" Content="Sony Computer Entertainment Inc.">
<style type="text/css"><!--
    div.fixedLay{position:absolute;z-index:100;left:0px;top:0px;}
--></style>
</head>
<body onload="iniFunc()" bgcolor="#ffffff" text="#000000" >
<div id="fixedLay0" class="fixedLay">
<a href="#top"><img src="gif/link.gif" border="0" alt="TOP"></a>
</div>
<table WIDTH="100%">
<tr><td>
<h3>"PlayStation 2" Programmer Tool Runtime Library Release 2.5.3</h3>
</td>
</tr>
<tr><td align= right >
<script language="JavaScript">
<!--
   var p,q;
   if ( parent.index ) {
   p = parent.index.location;
   q = p.toString();
   result = q.match(/\/category\.htm/gi);
   if(result == "/category.htm"){
          document.writeln("<a href=\"JavaScript:lj('libref','../libref/ikrnl_rf.htm')\"><img src=\"./gif/arrow.png\" border=0>\́^֐ꗗ</a>");
    }
}
// -->
</script>
</td></tr>
</table>
<hr noshade size=6>
<a name=Heading2>
<center><h1>
IOPvO~O
</h1></center>
</a>
<div align=center>
<table border=0 bgcolor=#F5F5F5 width=90%><tr><td>
<h2><u>
        <b>ڎ</b><br>
</u></h2>

<ul>
<p><a href="#Heading3_1">  1 <b>Tv</b></a>
    <ul>
    <a href="#Heading4_1_1"> <b>W[</b><br></a>
    <a href="#Heading4_1_2"> <b>W[̑݊ԁi풓 / 풓j</b><br></a>
    <a href="#Heading4_1_3"> <b>vO[_</b><br></a>
    </ul>
<p><a href="#Heading3_2">  2 <b>W[̍\</b></a>
    <ul>
    <a href="#Heading4_2_1"> <b>ZOg̔zu</b><br></a>
    <a href="#Heading4_2_2"> <b>W[ID</b><br></a>
    <a href="#Heading4_2_3"> <b>W[ƃW[o[W</b><br></a>
    </ul>
<p><a href="#Heading3_3">  3 <b>W[̃[hƋN</b></a>
    <ul>
    <a href="#Heading4_3_1"> <b>[hƋN̏菇</b><br></a>
    <a href="#Heading4_3_2"> <b>Gg[`</b><br></a>
    </ul>
<p><a href="#Heading3_4">  4 <b>W[̒~ƃA[h</b></a>
    <ul>
    <a href="#Heading4_4_1"> <b>~ƃA[h̏菇</b><br></a>
    <a href="#Heading4_4_2"> <b>Ȓ~ƎȃA[h</b><br></a>
    </ul>
<p><a href="#Heading3_5">  5 <b>풓Cu</b></a>
    <ul>
    <a href="#Heading4_5_1"> <b>풓Cû</b><br></a>
    <a href="#Heading4_5_2"> <b>Gge[u\̂ƃCuGg`t@C</b><br></a>
    <a href="#Heading4_5_3"> <b>Ăяoe[u\</b><br></a>
    <a href="#Heading4_5_4"> <b>XPg</b><br></a>
    </ul>
<p><a href="#Heading3_6">  6 <b>RpC̎菇</b></a>
    <ul>
    <a href="#Heading4_6_1"> <b>P[^uvÕRpC</b><br></a>
    <a href="#Heading4_6_2"> <b>풓CũRpC</b><br></a>
    </ul>
<p><a href="#Heading3_7">  7 <b>QlFW[ԃN̎dg</b></a>
    <ul>
    <a href="#Heading4_7_1"> <b>Gge[u\</b><br></a>
    <a href="#Heading4_7_2"> <b>Ăяoe[u\</b><br></a>
    <a href="#Heading4_7_3"> <b>ilbt@CtH[}bg</b><br></a>
    <a href="#Heading4_7_4"> <b>Ň݊`FbN</b><br></a>
    </ul>
<p><a href="#Heading3_8">  8 <b>QlFIOPIuWFNgtH[}bg</b></a>
    <ul>
    <a href="#Heading4_8_1"> <b>IOPW[ZNV</b><br></a>
    <a href="#Heading4_8_2"> <b>t@C̃f[^CAEg</b><br></a>
    <a href="#Heading4_8_3"> <b>̃f[^CAEg</b><br></a>
    <a href="#Heading4_8_4"> <b>ELFwb_̏ڍ</b><br></a>
    <a href="#Heading4_8_5"> <b>vOwb_e[ȕڍ</b><br></a>
    <a href="#Heading4_8_6"> <b>\V{</b><br></a>
    <a href="#Heading4_8_7"> <b>V{e[uGg</b><br></a>
    <a href="#Heading4_8_8"> <b>P[Ve[uGg</b><br></a>
    <a href="#Heading4_8_9"> <b>fobO</b><br></a>
    </ul>
<br></td></tr></table></div>

<!-- o@QC͌o -->
<a name=#"Heading2">

<!-- o@RCߌo -->
<a name="Heading3_1">
<h2>
 1 <b>Tv</b>
<hr noshade>
</h2>


<!-- o@SCo -->
<h3>
<a name="Heading4_1_1">
<a href="#Heading3_1"> 1. </a>1 <b>W[</b><br>
</a>
</h3>
<div style="margin-left:50px;">IOP̃ɂ͕̃vO[h邱Ƃ\łB<br>vOROMCD/DVD-ROMɃP[^uIuWFNgt@CƂĊi[Ă܂AKvɉă̋󂢂Ă̈Ƀ[hA[hꂽAhXɍ킹ăP[gĎs܂BIOPpIuWFNgt@C͒ʏ '.irx' ̊gqAIRXt@CƌĂ΂邱Ƃ܂BIRXt@C烁Ƀ[hꃊP[gꂽԂ̃vOAvOW[܂͒PɃW[ƌĂт܂B<br>W[͂ꂼЂƂ̃Gg[`iʏstart֐j܂BW[[hƃGg[`ĂяoA̕ԂlɂāAW[ɏ풓邩ǂ߂܂B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_1_2">
<a href="#Heading3_1"> 1. </a>2 <b>W[̑݊ԁi풓 / 풓j</b><br>
</a>
</h3>
<div style="margin-left:50px;">W[́Aꂪɑ݂Ԃɂĕނ邱Ƃł܂B<br>܂AGg[`xsƖڂIă郂W[܂B̂悤ȃW[풓W[ƌĂт܂B<br>tɁAGg[`̎sIɗ܂A荞݂⑼̃W[̃NGXgƂɂ̂ǏsW[܂B̂悤ȃW[풓W[ƌĂт܂BɁÃW[Tu[`ƂČĂяoGgW[풓CuƌĂт܂B<br>풓W[̒ɂ͂ɁAKvȂȂƂɂ̓ł̂܂B̂悤ȃW[A[h\ȏ풓W[ƌĂт܂B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_1_3">
<a href="#Heading3_1"> 1. </a>3 <b>vO[_</b><br>
</a>
</h3>
<div style="margin-left:50px;">vO[_́ACD/DVD-ROMROMvOW[[h/P[gAł̃W[̊Ǘs܂B<br>vO[_́Aw̃W[}l[WƏw̃t@C[_ɂ킩܂B<br>W[}l[W͈ȉ̂Ƃs܂B<br></div>
<div style="margin-left:40px;"><ul>
         <li> t@C[_^ꂽirx`̃IuWFNgf[^̌ƃIuWFNg̍Ĕzu
         <li> [hW[Ԃ̃N
         <li> 풓Ců֐̃Gge[u̓o^ / 폜̊Ǘ
</ul></div>
<div style="margin-left:50px;">t@C[_͈ȉ̂Ƃs܂B<br></div>
<div style="margin-left:40px;"><ul>
         <li> fBXNɂIuWFNgt@C̃[hƋN
         <li> W[̓o^ / 폜̊Ǘ
</ul></div>
<div style="margin-left:50px;"><br></div>

<!-- o@RCߌo -->
<a name="Heading3_2">
<h2>
 2 <b>W[̍\</b>
<hr noshade>
</h2>


<!-- o@SCo -->
<h3>
<a name="Heading4_2_1">
<a href="#Heading3_2"> 2. </a>1 <b>ZOg̔zu</b><br>
</a>
</h3>
<div style="margin-left:50px;">IOP̃ł͂ЂƂ̃W[͈ȉ̂R̃ZOgȂAeZOg͉}̏ŘAĔzuAꂼ̃TCY16byte̔{ɂȂĂ܂B<br><br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>ZOg</b>&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>e</b>&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;TEXT segment&nbsp;</td>
<td valign="TOP">&nbsp;vOR[hiK{j&nbsp;<br>&nbsp;CXgNVR[hƃW[ԃN̂߂&nbsp;<br>&nbsp;f[^\܂܂܂B&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;DATA segment&nbsp;</td>
<td valign="TOP">&nbsp;lf[^iꍇj&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;BSS segment&nbsp;</td>
<td valign="TOP">&nbsp;lf[^GAiꍇj&nbsp;</td>
</tr>
</table>
</div>
<br>
<br>
<div style="margin-left:50px;"></div>
<div style="margin-left:50px;"></div>
<div style="margin-left:67px;">
<p>
<img src="gif/iop_prog001.gif"><p>

</div>
<br>

<!-- o@SCo -->
<h3>
<a name="Heading4_2_2">
<a href="#Heading3_2"> 2. </a>2 <b>W[ID</b><br>
</a>
</h3>
<div style="margin-left:50px;">Ƀ[hꂽW[ɂ͎ʗpIDԍ蓖Ă܂BIDԍW[IDƌĂт܂B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_2_3">
<a href="#Heading3_2"> 2. </a>3 <b>W[ƃW[o[W</b><br>
</a>
</h3>
<div style="margin-left:50px;">W[ɂ́AW[ƃW[o[W邱Ƃł܂BW[̃\[XvOŁAȉ̂悤ɐ錾ĂB<br></div>
        <div style="margin-left:80px;"><pre><font size=3>ModuleInfo Module = {"Module_name", o[Wԍ };
</pre></font></div>
<div style="margin-left:50px;">O[oϐModule̓W[ƃW[o[Ww肷pr̂߂ɗ\񂳂Ă܂B<br>ModuleInfo\̂́Akernel.hŎ̂悤ɒ`Ă܂B<br></div>
        <div style="margin-left:80px;"><pre><font size=3>typedef struct _moduleinfo {
	const char		*name;
	const unsigned short	version;
} ModuleInfo;
</pre></font></div>
<div style="margin-left:50px;">nametB[hɂ́AW[̖̂w肵܂B̂Ɏgp镶́ApA'_'A'/' Ɍ肷邱Ƃ𐄏܂B<br>versiontB[h̏8bitɂ̓W[̃W[o[Wݒ肵A8bitɂ̓}Ci[o[Wݒ肵܂BW[o[WA}Ci[o[WƂA1ȏ̒lp܂B0͎gpȂłB<br>W[ƃW[o[ẂAɈȉ̗prŎgp܂B<br></div>
<div style="margin-left:40px;"><ul>
         <li> VXeu[gɃu[g[_v[XW[m邽
         <li> vOiW[jAm̃W[W[̃W[ID擾邽
         <li> vO}fobÕW[̃[hAhXc邽
         <li> fobKu[gς̃W[ƃfBXÑIuWFNgt@C̓ꐫmF邽
</ul></div>
<div style="margin-left:50px;">ȂAIOP̃vO[_́AW[ƃW[o[WĂȂvOłȂ[hs邱Ƃł܂B܂AW[ƃW[o[Ẅv镡̃W[ɑ݂邱ƂĂ܂B<br></div>

<!-- o@RCߌo -->
<a name="Heading3_3">
<h2>
 3 <b>W[̃[hƋN</b>
<hr noshade>
</h2>

<div style="margin-left:50px;">vO[_́AIOP̃VXeu[gLoadStartModule()ȂǂAPIɂĎwƂɁAIOPIuWFNgt@C[hAW[̃Gg[`Ăяo܂BGg[[`̖߂lɂāÃW[ɏ풓邩邩肳܂B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_3_1">
<a href="#Heading3_3"> 3. </a>1 <b>[hƋN̏菇</b><br>
</a>
</h3>
<div style="margin-left:50px;">W[̃[hƃGg[`̌Ăяo͈ȉ̎菇ōs܂B<br></div>
    <div style="margin-left:55px;"><ol>
         <li VALUE=1> IOPIuWFNgt@C`̃IuWFNgf[^𒲂ׁAKvȂ΃mۂAIuWFNgǂݍ񂾌AIuWFNgĔzu</li>
         <li VALUE=2> W[BSS segment[NA</li>
         <li VALUE=3> W[TEXT segment𒲍A풓Ců֐ĂяoĂ΃N</li>
         <li VALUE=4> W[ɃW[ID蓖Ă</li>
         <li VALUE=5> W[̃Gg[`Ăяo</li>
         <li VALUE=6> Gg[`̖߂lɂāÃW[풓邩ۂ肵</li>
</ol></div>
</ul></div>
<div style="margin-left:50px;">L̎菇ɂāAW[͉}̂悤ɏԑJڂ܂B<br></div>
<div style="margin-left:50px;"></div>
<div align=center>
<p>
<img src="gif/iop_prog002.gif"><p>

</div>
<br>

<!-- o@SCo -->
<h3>
<a name="Heading4_3_2">
<a href="#Heading3_3"> 3. </a>2 <b>Gg[`</b><br>
</a>
</h3>
<div style="margin-left:50px;">W[̃Gg[`́Â悤ȃvg^CvȂ΂Ȃ܂B<br></div>
        <div style="margin-left:80px;"><pre><font size=3>int start(intc argc, char *argv[]);
</pre></font></div>
<div style="margin-left:50px;">vO[_́AGg[`spɊmۂĂXbhNÃXbh̒ňȉ̎菇ŃGg[`Ăяo܂B<br></div>
    <div style="margin-left:55px;"><ol>
         <li VALUE=1> X^bNɁAargv[]zƈς</li>
         <li VALUE=2> W[GP(global pointer)valueGP register($28)ɃZbg</li>
         <li VALUE=3> Gg[`Tu[`R[</li>
         <li VALUE=4> iW[̃Gg[[`sj</li>
         <li VALUE=5> Gg[`̖߂l̉2rbgɂăW[̏풓^풓肷</li>
         <li VALUE=6> XbhI</li>
</ol></div>
</ul></div>
<div style="margin-left:50px;">W[̃vO}̓Gg[`ȉ̊œ삷悤ɑg܂Ȃ΂Ȃ܂B<br></div>
<div style="margin-left:40px;"><ul>
         <li> sXbh̃X^bNTCY2KB
         <li> sXbh̗D揇ʂMODULE_INIT_PRIORITY(=8)
         <li> argc͈ʓICmain֐̈Ɠi1ȏj
         <li> argv͈ʓICmain֐̈Ɠ
</ul></div>
<div style="margin-left:50px;">Gg[`spɊmۂĂXbh͂ЂƂȂ̂ŁAقȂ郂W[̃Gg[`sĎs邱Ƃ͌ƂĂ܂BāAʏ̃W[̃Gg[`ł́ÃW[̃Gg[`Ə邱ƂlKv͂܂BOƂāAGg[`̂ȂLoadStartModule()ȂǂAPIpĂɑ̃W[Nꍇ́AGg[`̎slXg܂B̌ʁAgp\X^bNTCYɌ܂B<br>Gg[`̖߂l̉2rbǵAȉ̂ꂩɂȂ΂Ȃ܂B̑̃rbg͎RɎgĂ܂܂B<br><br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>l</b>&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>Ӗ</b>&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;NO_RESIDENT_END&nbsp;</td>
<td valign="TOP">&nbsp;W[̓ދi풓W[j&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;RESIDENT_END&nbsp;</td>
<td valign="TOP">&nbsp;W[̓ɏ풓i풓W[j&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;REMOVABLE_RESIDENT_END&nbsp;</td>
<td valign="TOP">&nbsp;W[̓ɏ풓&nbsp;<br>&nbsp;iA[h\풓W[j&nbsp;</td>
</tr>
</table>
</div>
<br>

<div style="margin-left:40px;"><h4><b>풓W[̃vÕXPg</b><br></h4></div>

        <div style="margin-left:80px;"><pre><font size=3>#include &lt;kernel.h&gt;

int start(int argc, char *argv[])
{
	/* vÔׂƂsB*/
	return NO_RESIDENT_END;
}
</pre></font></div>

<div style="margin-left:40px;"><h4><b>풓W[̃vÕXPg</b><br></h4></div>

        <div style="margin-left:80px;"><pre><font size=3>#include &lt;kernel.h&gt;

int start(int argc, char *argv[])
{
    /* W[̏풓ɕKvȏȂǂsB*/
    if( ɐ )
        return RESIDENT_END;
    else
        return NO_RESIDENT_END;
}
</pre></font></div>

<!-- o@RCߌo -->
<a name="Heading3_4">
<h2>
 4 <b>W[̒~ƃA[h</b>
<hr noshade>
</h2>

<div style="margin-left:50px;">Gg[`REMOVABLE_RESIDENT_ENDԂ풓W[́AvO[_ɃA[h\ȏ풓W[łƔFA풓StopMdoule()UnloadModule()2APIɂč폜邱Ƃ\ɂȂ܂B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_4_1">
<a href="#Heading3_4"> 4. </a>1 <b>~ƃA[h̏菇</b><br>
</a>
</h3>
<div style="margin-left:50px;">vO[_́A풓W[̃[hɃW[gi[郁̈mۂAA[hɂ̃̈܂BȊOɏ풓W[g̎s̉ߒŊmۂꂽi / Xbh / CxgtO / Z}tHj΁A̓vO[_̊ǗOł̂ŁA풓W[gŉKv܂B<br>̂ߏ풓W[̃A[h́A܂W[Ŏ̉Ȃǂs~ƁAW[}l[Wŏ풓W[폜폜2iKōs܂B<br>풓W[̒~sAPIStopModule()łBStopModule()sƁAvO[_̓Gg[`spɊmۂĂXbhNÃXbh̒ňȉ̎菇ŃGg[`Ăяo܂B<br></div>
    <div style="margin-left:55px;"><ol>
         <li VALUE=1> X^bNargv[]zƈςށBargv[0]ɂ͏"other"Ƃݒ肷B܂A~̌Ăяoł邱Ƃ\߂ɁAargcɂ͕̒liΒlargv[]œn̐jݒ肷</li>
         <li VALUE=2> W[GP(global pointer) valueGP register($28)ɃZbg</li>
         <li VALUE=3> Gg[`Tu[`R[</li>
         <li VALUE=4> iW[̃Gg[[`sBargcł邱Ƃ𔻕ʂĎ̉Ȃǂsj</li>
         <li VALUE=5> Gg[`̖߂l̉2rbgNO_RESIDENT_ENDłΒ~̂ƂAW[~ԂƂ݂ȂB߂lREMOVABLE_RESIDENT_ENDł΁A~sŃW[͈ғԂłƂ݂Ȃ</li>
         <li VALUE=6> XbhI</li>
</ol></div>
</ul></div>
<div style="margin-left:50px;">풓W[̍폜sAPIUnloadModule()łBUnloadModule()́AΏۃW[~Ԃł邱ƂmFAW[̓o^폜܂B܂ΏۃW[̐߂郁̈悪[hɎIɊmۂꂽ̂łΉ܂B<br>L̎菇ɂāAW[͉}̂悤ɏԑJڂ܂B<br></div>
<div style="margin-left:50px;"></div>
<div align=center>
<p>
<img src="gif/iop_prog003.gif"><p>

</div>
<br>

<div style="margin-left:40px;"><h4><b>A[h\풓W[̃vÕXPg</b><br></h4></div>

        <div style="margin-left:80px;"><pre><font size=3>#include &lt;kernel.h&gt;

int module_start(int argc, char *argv[]) {
	/* W[̏풓ɕKvȏȂǂsB*/
	if( ɐ )
		eturn REMOVABLE_RESIDENT_END;
	else {
		/* KvȂ΁ÃLZs */
		return NO_RESIDENT_END;
	}
}

int module_stop(int argc, char *argv[]) {
	/* W[̍폜OɕKvȏIȂǂsB*/
	if( Iɐ )
		return NO_RESIDENT_END;
	else {
		/* \Ȃ΁AĨLZsA
		* 풓𑱍sł悤ȏԂɖ߂B*/
		return REMOVABLE_RESIDENT_END;
	}
}

int start(int argc, char *argv[]) {
	if( argc &gt;= 0 )    return module_start(argc, argv);
	else               return module_stop(-argc, argv);
}
</pre></font></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_4_2">
<a href="#Heading3_4"> 4. </a>2 <b>Ȓ~ƎȃA[h</b><br>
</a>
</h3>
<div style="margin-left:50px;">StopModule() / UnloadModule()ł́AȃW[Ώۂɂ邱Ƃ͂ł܂BȃW[A[h邽߂ɂ́ASelfStopModule() / SelfUnloadModule()gpAȉ̓_ɒӂȂ΂Ȃ܂B<br></div>
<div style="margin-left:40px;"><ul>
         <li> ȃA[h郂W[SelfStopModule() / SelfUnloadModule()s邽߂̃Xbh쐬Ȃ΂Ȃ
         <li> Gg[[`Œ~ƂɏL̃Xbh폜Ȃ悤ɂȂ΂ȂȂ
         <li> ̃W[폜\lق悢
</ul></div>
<div style="margin-left:50px;">SelfStopModule()sƁAStopModule()̂ƂƓlɃW[̃Gg[[`Ăяo܂BStopModule()ƈႤ_argv[0]ɗ^镶"self"ɂȂ邱ƂłBăGg[`́Aargv[0]̓eɉāA~ō폜ׂXbh̐𔻒fȂ΂Ȃ܂B<br>ȃA[hP[X܂߂W[̏ԑJڂ͉}̂悤ɂȂ܂B<br></div>
<div style="margin-left:50px;"></div>
<div align=center>
<p>
<img src="gif/iop_prog004.gif"><p>

</div>
<br>

<div style="margin-left:40px;"><h4><b>ȃA[h\풓W[̃vÕXPg</b><br></h4></div>

        <div style="margin-left:80px;"><pre><font size=3>#include &lt;kernel.h&gt;

/* ȍ폜\풓W[́Aȉ̂悤
 * Ȃ폜邽߂̃XbhȂ΂ȂȂ */
int special_thread() {
	:
	:
	SelfStopModule(args, argp, &result);
	SelfUnloadModule(); /* Unload & ExitDeleteThread */
	/* Never returns here */
}

int module_start(int argc, char *argv[]) {
	/* W[̏풓ɕKvȏȂǂsB
	* SelfStopModule()/SelfUnloadModule() s邽߂
	* Xbhō쐬B
	*/
	if( ɐ )
		return REMOVABLE_RESIDENT_END;
	else {
		/* KvȂ΁ÃLZs */
		return NO_RESIDENT_END;
	}
}

int module_stop(int argc, char *argv[]) {
	if( strcmp(argv[0],"other") == 0 ) {
		/* ̃W[ɂ StopModule() ꂽP[XB
		* W[̍폜OɕKvȏIȂǂsB
		*/
	} else if( strcmp(argv[0],"self") == 0 ) {
		/* W[ɂ SelfStopModule() ꂽP[XB
		* W[̍폜OɕKvȏIȂǂsB
		* ASelfStopModule()/SelfUnloadModule() s
	* Xbh͍폜ȂB
	*/
	}
	if( Iɐ )
		return NO_RESIDENT_END;
	else {
		/* \Ȃ΁AĨLZsA
		* 풓𑱍sł悤ȏԂɖ߂B*/
		return REMOVABLE_RESIDENT_END;
	}
}

int start(int argc, char *argv[]) {
	if( argc &gt;= 0 )    return module_start(argc, argv);
	else               return module_stop(-argc, argv);
}
</pre></font></div>

<!-- o@RCߌo -->
<a name="Heading3_5">
<h2>
 5 <b>풓Cu</b>
<hr noshade>
</h2>

<div style="margin-left:50px;">풓W[́Â֐Q̈ꕔ𑼂̃W[ɒ񋟂풓CuɂȂ邱Ƃł܂B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_5_1">
<a href="#Heading3_5"> 5. </a>1 <b>풓Cû</b><br>
</a>
</h3>
<div style="margin-left:50px;">풓CúÃW[ɒ񋟂Tu[`Gg܂Ƃ߂Gge[u\̂Ƃ΂\̂܂Bʏ̓W[̏풓ɁARegisterLibraryEntries()gpĎ̎Gge[u\̂VXeɓo^܂B܂~ɂ́AGge[u\̂̓o^ReleaseLibraryEntries()gpčs܂B<br>A풓Cu𗘗p郂W[́ApTu[`̃CfbNX܂Ƃ߂Ăяoe[u\̂܂B̃W[[hƂɁAĂяoe[uo^ς݂̏풓CũGge[u\̂ƏƍAYTu[`̃GgAhXɏ܂B<br></div>
<div style="margin-left:50px;"></div>
<div style="margin-left:67px;">
<p>
<img src="gif/iop_prog005.gif"><p>

</div>
<br>
<div style="margin-left:50px;">A[h\ȏ풓W[풓CuƂ邱Ƃ\łB̏ꍇ͏L̃Gge[u\̂Ɋւ鏈ƂƂɁAA[h\ȏ풓W[ɕKvȒ~sKv܂B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_5_2">
<a href="#Heading3_5"> 5. </a>2 <b>Gge[u\̂ƃCuGg`t@C</b><br>
</a>
</h3>
<div style="margin-left:50px;">Gge[u\̂́ACuGg`t@CƂioplibgen[eBeBpč쐬邱Ƃł܂B<br>CuGg`t@ĆAȉ4ނ̋Lq܂܂ꂽeLXgt@CłB<br></div>

<!-- o@TCiPj -->
<div style="margin-left:40px;"><a name="Heading5_5_2_1"><h4>
(1)&nbsp;<b>Rg</b><br></h4>
</a></div>
<div style="margin-left:67px;">'#'Ŏn܂s̓RgsɂȂ܂B<br></div>

<!-- o@TCiPj -->
<div style="margin-left:40px;"><a name="Heading5_5_2_2"><h4>
(2)&nbsp;<b>Cu錾</b><br></h4>
</a></div>
<div style="margin-left:67px;">Cui8ȓjȉ̂悤ɐ錾܂B<br></div>
        <div style="margin-left:80px;"><pre><font size=3>Libname libname
</pre></font></div>

<!-- o@TCiPj -->
<div style="margin-left:40px;"><a name="Heading5_5_2_3"><h4>
(3)&nbsp;<b>Cuo[W錾</b><br></h4>
</a></div>
<div style="margin-left:67px;">CũW[o[Wi8bitjƃ}Ci[o[Wi8bitjA '.' ŋ؂10iňȉ̂悤Ɏw肵܂<br></div>
<div style="margin-left:80px;">Version <i>MM</i>.<i>mm</i><br></div>
<div style="margin-left:67px;">W[o[Wƃ}Ci[o[ẂA1ȏ255ȉ̐lw肵ĂB0̓U[uĂ܂B<br></div>

<!-- o@TCiPj -->
<div style="margin-left:40px;"><a name="Heading5_5_2_4"><h4>
(4)&nbsp;<b>Gg錾</b><br></h4>
</a></div>
<div style="margin-left:67px;">ȉ̏ŁACũGg֐𕡐錾ł܂B<br></div>
<div style="margin-left:80px;">Entry/<i>level</i> <i>entry_symbol</i> [<i>entry_internal_symbol</i>]<br>Entry <i>entry_symbol</i> [<i>entry_internal_symbol</i>]<br>Entry -<br></div>
<div style="margin-left:67px;"><i>level</i>́A<i>entry_symbol</i>̌Jx1̐lŎw肵܂Bioplibgen-lIvVŌJxw肷ƁA̐lȉ̌Jx<i>entry_symbol</i>݂̂Gge[ut@Cɏo͂܂B<i>level</i>ȗƌJx0Ƃ݂Ȃ܂B<br></div>

<div style="margin-left:40px;"><h4><b>\Gg</b><br></h4></div>

<div style="margin-left:67px;">Gge[u\̂ɓo^Ă֐͎sɂ̓e[ȕԁiCfbNXjɂĎʂ܂B֐ƃe[ũCfbNX̑Ή́AƂĂ̓vO}RɌ߂Ă܂܂B<br>AVXeT[rX̊Ǘ̓sŁAŏ̂S̃Gg͊֐Ɋւ炸Aȉ̂悤ɖŒ肳Ă܂B<br><br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>CfbNX</b>&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>֐̋@\</b>&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;0&nbsp;</td>
<td valign="TOP">&nbsp;Cȕpɗ\iڍזj&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;1&nbsp;</td>
<td valign="TOP">&nbsp;Cu̍ďpɗ\iڍזj&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;2&nbsp;</td>
<td valign="TOP">&nbsp;CȕI&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;3&nbsp;</td>
<td valign="TOP">&nbsp;\iڍזj&nbsp;</td>
</tr>
</table>
</div>
<br>
<br>
<div style="margin-left:67px;">̂S̃GǵAY֐ꍇɂ͂̊֐o^Aꍇɂ́AɒPɃ^[֐o^Ȃ΂Ȃ܂B<br></div>

<div style="margin-left:40px;"><h4><b>I</b><br></h4></div>

<div style="margin-left:67px;">CȕI֐́Aȉprototype܂B<br></div>
        <div style="margin-left:80px;"><pre><font size=3>	void  lib_terminate(int mode);
</pre></font></div>
<div style="margin-left:67px;">modeɂAI֐Ăяow肳܂B<br><br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>mode</b>&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b></b>&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;0&nbsp;</td>
<td valign="TOP">&nbsp;VXeIirebootj&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;1&nbsp;</td>
<td valign="TOP">&nbsp;W[폜iݖA\j&nbsp;</td>
</tr>
</table>
</div>
<br>
<br>
<div style="margin-left:67px;">reboot̂߂̏I֐̌ĂяóAʏAVXe荞݋֎~ɂōs܂BA荞݋֎~Ԃł͏IsłȂ풓Cu肤邽߁A炩SetRebootTimeLibraryHandlingMode() ֐pāAI֐̌Ăяo^C~O풓CuƂɐݒ肵ĂƂł܂Bݒł^C~O͈ȉ3ƂłB<br></div>
    <div style="margin-left:65px;"><ol TYPE="a">
         <li VALUE=1> 荞݋֎~ɂɌĂяoiftHgj</li>
         <li VALUE=2> 荞݋֎~ɂOɌĂяo</li>
         <li VALUE=3> 荞݋֎~ɂOƋ֎~ɂɂꂼPĂяo</li>
</ol></div>
</ul></div>

<div style="margin-left:40px;"><h4><b>CuGg`t@C̗</b><br></h4></div>

        <div style="margin-left:80px;"><pre><font size=3># ܂ŏɃCu錾B̗ł 'mylib' Ɛ錾B
Libname mylib
# version̐錾B
Version 1.1
# ========= 풓CůeGg̐錾 =============
# Kɂŏ̎l̃Gg̓VXepɃU[uĂ
# PԖڂ́ACȕpɗ\iڍזj
# QԖڂ́ACu̍ďpɗ\iڍזj
# RԖڂ́A΁AIGg
# SԖڂ́A\
Entry -
Entry -
Entry -
Entry -
Entry AllocMemory
Entry ReAllocMemory
# OĂԂƂ̊֐ƁAۂ̊֐͈ȉ̂悤ɈقĂĂ悢
# 	O		
Entry FreeMemory		mylib_free_memory
</pre></font></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_5_3">
<a href="#Heading3_5"> 5. </a>3 <b>Ăяoe[u\</b><br>
</a>
</h3>
<div style="margin-left:50px;">풓CugpvOŕKvȌĂяoe[u\̂́Aʏioplibld[eBeBpĎ쐬܂B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_5_4">
<a href="#Heading3_5"> 5. </a>4 <b>XPg</b><br>
</a>
</h3>
<div style="margin-left:50px;">풓Cu쐬邽߂̎QlƂāACuGg`t@CiGge[u\́jƃvÕXPg܂BvÕXPǵAʏ̏풓CuƃA[h\ȏ풓CuƂɂĂꂼꎦĂ܂B<br></div>

<div style="margin-left:40px;"><h4><b>CuGg`t@C̃XPg</b><br></h4></div>

        <div style="margin-left:80px;"><pre><font size=3>Libname mylib
Version 1.1
Entry	-
Entry	-
Entry	-
Entry	-
Entry	libentry1
Entry	libentry2
</pre></font></div>

<div style="margin-left:40px;"><h4><b>풓CũvÕXPg</b><br></h4></div>

        <div style="margin-left:80px;"><pre><font size=3>#include &lt;kernel.h&gt;

int start(int argc, char *argv[])
{
	extern libhead mylib_entry;

	/* W[̏풓ɕKvȏȂǂsB*/
	if( Ɏs ) {
		/* KvȂ΁ÃLZs */
		return NO_RESIDENT_END;
	}

	/* g̃Gge[uVXeɓo^B */
	if( RegisterLibraryEntries(&mylib_entry) == KE_OK )
		return RESIDENT_END;
	else {
		/* KvȂ΁ÃLZs */
		return NO_RESIDENT_END;
	}
}

int libentry1()
{
  /* .... */
}

int libentry2()
{
  /* .... */
}
</pre></font></div>

<div style="margin-left:40px;"><h4><b>A[h\풓CũvÕXPg</b><br></h4></div>

        <div style="margin-left:80px;"><pre><font size=3>#include &lt;kernel.h&gt;

int module_start(int argc, char *argv[]) {
	extern libhead mylib_entry;

	/* W[̏풓ɕKvȏȂǂsB*/
	if( Ɏs ) {
		/* KvȂ΁ÃLZs */
		return NO_RESIDENT_END;
	}

	/* g̃Gge[uVXeɓo^B */
	if( RegisterLibraryEntries(&mylib_entry) == KE_OK )
		return REMOVAL_RESIDENT_END;
	else {
		 /* KvȂ΁ÃLZs */
		return NO_RESIDENT_END;
    }
}

int module_stop(int argc, char *argv[]) {
	/* g̃Gge[uVXe疕B */
	ReleaseLibraryEntries(&mylib_entry);

	/* W[̍폜OɕKvȏIȂǂsB*/
	if( Iɐ )
		return NO_RESIDENT_END;
	else {
		/* \Ȃ΁AĨLZsA
		* 풓𑱍sł悤ȏԂɖ߂B
		* KvȂΎg̃Gge[u̍ēo^s
		*/
		return REMOVABLE_RESIDENT_END;
	}
}
</pre></font></div>
<div style="margin-left:50px;"><br></div>
        <div style="margin-left:80px;"><pre><font size=3>int start(int argc, char *argv[]) {
	if( argc &gt;= 0 )    return module_start(argc, argv);
	else               return module_stop(-argc, argv);
}
</pre></font></div>
<div style="margin-left:50px;"><br></div>
        <div style="margin-left:80px;"><pre><font size=3>int libentry1()
{
  /* .... */
}

int libentry2()
{
  /* .... */
}

</pre></font></div>

<!-- o@RCߌo -->
<a name="Heading3_6">
<h2>
 6 <b>RpC̎菇</b>
<hr noshade>
</h2>


<!-- o@SCo -->
<h3>
<a name="Heading4_6_1">
<a href="#Heading3_6"> 6. </a>1 <b>P[^uvÕRpC</b><br>
</a>
</h3>
<div style="margin-left:50px;">P[^uvO쐬邽߂ɂ́A`IȃRpCEN菇̍Ō̒iKŃvÕAhX肷ɁAJ̃p[VN@\ŃIuWFNgЂƂɂ܂Ƃ߁Aiopfixup[eBeBpIOPP[^us`֕ϊƂ菇𓥂݂܂B<br></div>
<div style="margin-left:50px;"></div>
<div style="margin-left:67px;">
<p>
<img src="gif/iop_prog006.gif"><p>

</div>
<br>

<div style="margin-left:40px;"><h4><b>P[^uvÕRpC菇̗</b><br></h4></div>

<div style="margin-left:67px;">P[^uvORpC菇́AƂΎ̂悤ɂȂ܂B<br></div>
        <div style="margin-left:80px;"><pre><font size=3>$ iop-gcc -c xxx1.c
$ iop-gcc -c xxx2.c
$ iop-ld -r -dc -o xxxx.o xxx1.o xxx2.o -lyyy
$ iopfixup -o xxxx.irx xxxx.o
</pre></font></div>
<div style="margin-left:50px;"><br></div>
<div style="margin-left:67px;">LƊȒPɍς܂ɂ͎̂悤ɂ܂B<br></div>
        <div style="margin-left:80px;"><pre><font size=3>$ iop-gcc -c xxx1.c
$ iop-gcc -c xxx2.c
$ iop-gcc -o xyz.irx xxx1.o xxx2.o -lyyy
</pre></font></div>
<div style="margin-left:50px;"><br></div>
<div style="margin-left:67px;">ɊȒPɂƁÂPR}hōς܂邱Ƃł܂B<br></div>
        <div style="margin-left:80px;"><pre><font size=3>$ iop-gcc -o xyz.irx xxx1.c xxx2.c -lyyy
</pre></font></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_6_2">
<a href="#Heading3_6"> 6. </a>2 <b>풓CũRpC</b><br>
</a>
</h3>
<div style="margin-left:50px;">풓CuƂ́AvOR[ḧꕔ𑼂̃W[Tu[`ƂČĂяo悤ɒ񋟂Ă郂W[łB<br>풓Cuɂ͂̃W[ǂ̂悤ȃTu[`񋟂邩Gge[u\̂KvłB܂A풓Cu񋟂Tu[`𗘗p郂W[ɂ́Aǂ̃W[̂ǂ̃Tu[`𗘗p邩Ăяoe[u\̂KvłB̍\̂𐶐N邽߂ɁAioplibgen[eBeBioplibld[eBeBpӂĂ܂B<br>풓CuƁA풓Cu𗘗p郂W[̃RpCEN̎菇͉}̂悤ɂȂ܂B<br></div>
<div style="margin-left:50px;"></div>
<div style="margin-left:67px;">
<p>
<img src="gif/iop_prog007.gif"><p>

</div>
<br>

<div style="margin-left:40px;"><h4><b>풓CuW[̃RpC菇</b><br></h4></div>

        <div style="margin-left:80px;"><pre><font size=3>$ ioplibgen -d stubs.ilb -e entry.s entry.tbl
$ iop-as -o entry.o entry.s 
$ iop-gcc -c lll1.c
$ iop-gcc -c lll2.c
$ iop-ld -r -dc -o lmn.o lll1.o lll2.o entry.o
$ iopfixup -o lnm.irx lnm.o
</pre></font></div>

<div style="margin-left:40px;"><h4><b>풓Cu𗘗p郂W[̃RpC菇</b><br></h4></div>

<div style="margin-left:67px;">(a)X^eBbNCuNȂꍇ<br></div>
        <div style="margin-left:80px;"><pre><font size=3>$ iop-gcc -c xxx1.c
$ iop-gcc -c xxx2.c
$ ioplibld -s stub.s xxx1.o xxx2.o : stubs.ilb
$ io-as -o stubs.o stubs.s
$ iop-ld -r -dc -o xyz.o xxx1.o xxx2.o stubs.o
$ iopfixup -o xyz.irx xyz.o
</pre></font></div>
<div style="margin-left:67px;">ƊȒPɍς܂ɂ́cc<br></div>
        <div style="margin-left:80px;"><pre><font size=3>$ iop-gcc -c xxx1.c
$ iop-gcc -c xxx2.c
$ iop-gcc -o xyz.irx xxx1.o xxx2.o -ilb=stubs.ilb
</pre></font></div>
<div style="margin-left:67px;">(b)X^eBbNCuNꍇ<br></div>
        <div style="margin-left:80px;"><pre><font size=3>$ iop-gcc -c xxx1.c
$ iop-gcc -c xxx2.c
$ ioplibld -s stub.s xxxall.o xxx1.o xxx2.o -lsss : stubs.ilb
$ io-as -o stubs.o stubs.s
$ iop-ld -r -dc -o xyz.o xxx1.o xxx2.o stubs.o -lsss
$ iopfixup -o xyz.irx xyz.o
</pre></font></div>
<div style="margin-left:67px;">ƊȒPɍς܂ɂ́cc<br></div>
        <div style="margin-left:80px;"><pre><font size=3>$ iop-gcc -c xxx1.c
$ iop-gcc -c xxx2.c
$ iop-gcc -o xyz.irx xxx1.o xxx2.o -lsss -ilb=stubs.ilb
</pre></font></div>
<div style="margin-left:50px;"><br></div>
<div style="margin-left:67px;">ȂAIOP kernel̂̂̏풓CuW[\Ă܂B̂߂ׂẴAvP[VvÓAȂ炸u풓Cu𗘗p郂W[vƂĐ邱ƂɂȂ܂B<br></div>

<!-- o@RCߌo -->
<a name="Heading3_7">
<h2>
 7 <b>QlFW[ԃN̎dg</b>
<hr noshade>
</h2>

<div style="margin-left:50px;">IOPvO[_̓W[̃[hɊYW[̃[hσW[i풓CujĂяoĂ邩ǂAKvȏꍇ̃W[Ƃ̃Ns܂B̃N@\́AĂяo풓CũGge[u\̂ƌĂяoW[̌Ăяoe[u\̂𑀍삷邱Ƃōs܂B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_7_1">
<a href="#Heading3_7"> 7. </a>1 <b>Gge[u\</b><br>
</a>
</h3>
<div style="margin-left:50px;">풓CũW[ɒ񋟂֐Q́AȉɎGge[u\̂ŋLqAW[̋NɃW[gɂăvO[_API RegisterLibraryEntries()gpăVXeɓo^܂B<br>ЂƂ̃W[o^łGge[u\̂̐ɐ͂܂B܂AЂƂ̃W[̃Cuo^邱Ƃł܂B<br></div>

<div style="margin-left:40px;"><h4><b>Gge[u\̂̌`</b><br></h4></div>

<div style="margin-left:67px;">Gge[u\͎̂̌`܂B<br><br></div>
        <div style="margin-left:80px;"><pre><font size=3>	.text
	.set noreorder
	.globl  mylib_entry
mylib_entry:
	.word  0x41c00000	/* magic number of entry table */
	.word  0		/* reserved */
	.short  0x0101		/* version */
	.short  0x0000		/* flags */
	.ascii  "mylib\0\0\0"	/* library name (max 8 characters) */
	.align  2

	.word		MylibEntry1	/* address of function 1 */
	.word		MylibEntry2	/* address of function 2 */
	.word		MylibEntry3	/* address of function 3 */
	.word		MylibEntry4	/* address of function 4 */
	:
	:
	.word  0		/* table end mark */
</pre></font></div>
<div style="margin-left:67px;"><br>q̗\Gg̋KɂAGg֐͂Sȏo^ĂȂ΂Ȃ܂B<br>'flags'̃tB[h́Á݂AIOPVXeGge[ůǗɎgptB[hłBȂ炸0ĂB<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_7_2">
<a href="#Heading3_7"> 7. </a>2 <b>Ăяoe[u\</b><br>
</a>
</h3>
<div style="margin-left:50px;">Ăяoe[u\̂́A郂W[̏풓CuW[񋟂Ă֐gp邱Ƃ\\̂łB`̓Gge[u\̂ƎĂ܂ÃW[KvƂ֐e[uɊ܂݂܂B<br>IOPvO[_́AW[̃[hɌĂяoe[u\̒jump߂ăW[Ԃ̃Ns܂B<br></div>

<div style="margin-left:40px;"><h4><b>Ăяoe[u\̂̌`</b><br></h4></div>

        <div style="margin-left:80px;"><pre><font size=3>	.text
	.set noreorder
	.globl  mylib_stub
mylib_stub:
	.word  0x41e00000	/* magic number of call table */
	.word  0			/* reserved */
	.short  0x0101		/* version */
	.short  0x0000		/* flags */
	.ascii  "mylib\0\0\0"	/* library name (max 8 characters) */
	.align  2

	.globl          MylibEntry1
MylibEntry1:
	j      $31
	.half   0		/* entry table index */
	.half   0x2400	/* index magic : 0x2400XXXX == addiu $0,$0,XXXX */

	.globl		MylibEntry2
MylibEntry2:
	j      $31
	.half   2		/* entry table index */
	.half   0x2400	/* index magic */
	:
	:
	:
	.word   0, 0	/* table end mark */
</pre></font></div>
<div style="margin-left:50px;"><br></div>
<div style="margin-left:67px;">Ăяo֐GgЂƂ܂܂ȂĂяoe[u\̂͋܂B<br>'flags' ̃tB[h́Á݂AIOPVXeĂяoe[ůǗ̂߂ɎgptB[hłBȂ炸0ĂB<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_7_3">
<a href="#Heading3_7"> 7. </a>3 <b>ilbt@CtH[}bg</b><br>
</a>
</h3>
<div style="margin-left:50px;">풓Cu쐬ꍇACuƃCuo[WAуCůe֐̖Oƃe[uCfbNX̑ΉLqf[^t@Ciilbt@Cj쐬Kv܂B<br>̃t@C̓Cu𗘗p鑤̃W[̃NɁAĂяoe[u\̂쐬邽߂̏Ƃėp܂B<br>ȉ̂悤ɌŒ`̃eLXgt@CƂAf[^t@C̊gq '.ilb' Ƃ܂B<br><br></div>
        <div style="margin-left:80px;"><pre><font size=3>#IOP-ILB# Cӂ̕ 
L Cu 
V 0xHHHH 
F 0xHHHH
E ddd entryname 
E ddd entryname 
E ddd entryname 
</pre></font></div>
<div style="margin-left:50px;"><br>ŏ '#IOP-ILB#'Ŏn܂s͑eLXgsilb-data`ł邱Ƃ錾܂B<br>'L' Ŏn܂s͕K2sڂɈʒu,3ڂs܂8ȓ̃Cu<br>'V' Ŏn܂s͕K3sڂɈʒu,5ڂ416i<br>'F' Ŏn܂s͕K4sڂɈʒu,5ڂ416i0w肵܂B<br>5sڈȍ~'E'Ŏn܂3ڂ310iƁA7ڂs܂ł̃Gg<br><br>ilb-data`ĂЂƂ̃t@CɊi[Ă悢̂Ƃ܂B̏ꍇ'#IOP-ILB#'؂LƂ݂Ȃ܂B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_7_4">
<a href="#Heading3_7"> 7. </a>4 <b>Ň݊`FbN</b><br>
</a>
</h3>
<div style="margin-left:50px;">Oq̂悤ɃGge[u\̂ƌĂяoe[u\̂ɂlibrary nametB[hversiontB[h܂B<br>library nametB[h8bytẽTCYA8byteɖȂȌꍇnullŃpfBOĂB<br>versiontB[h̏8bit́ACũW[o[Wݒ肵A8bit́A}Ci[o[Wݒ肵܂B<br>versiontB[h̐ݒ́A{Iɂ̓vO}ɔCĂ܂A̋K肪܂B<br>W[o[ẂA֐e[u̕яAyъ֐̎dlɌ݊̂ꍇAl悤ɐݒ肵Ȃ΂܂B<br>}Ci[o[ẂAoOtBbNX݊ۂ@\ǉsꂽƂɍXV܂B<br>W[o[WA}Ci[o[WƂA1ȏ̒lp܂B0͎gpȂłB<br><br>W[IOPɃ[hāAɊ܂܂Ăяoe[u\̂NƂɂ́Alibrary nametB[hƁAW[o[Wvo^ς̃Gge[u\̂AƃN܂B<br>iӁF2000N4݁AvO[_͏L̂悤ɓ삵܂AĂяoe[u\̂̎w肷}Ci[o[W}Ci[o[W̃Gge[u\̂Ƃ̓NoȂ]܂̂ŁAꂻ̂悤ɕύX\łBj<br><br>Gge[u\̂̃VXeւ̓o^́Aɓo^Ă郉Culibrary nameƃW[o[WvāA}Ci[o[W傫݂̂ꍇ́Ao^Ɏs܂B<br></div>

<!-- o@RCߌo -->
<a name="Heading3_8">
<h2>
 8 <b>QlFIOPIuWFNgtH[}bg</b>
<hr noshade>
</h2>

<div style="margin-left:50px;">IOPIuWFNgtH[}bǵAMIPS R3000ELF`P[^ut@CtH[}bgɎ኱̒ǉEύXÊłB<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_8_1">
<a href="#Heading3_8"> 8. </a>1 <b>IOPW[ZNV</b><br>
</a>
</h3>
<div style="margin-left:50px;">IOPIuWFNgtH[}bgɂ́AIOPW[ZNVVKɒǉ܂B<br>IOPW[ZNV͈ȉ̍\̉ϒ̃f[^AIOPvO[_W[[hɎsɕKvȏݒ肵܂B<br><br></div>
        <div style="margin-left:80px;"><pre><font size=3>/* A section of type SHT_SCE_IOPMOD contains the following structure.  */
typedef struct _Elf32_IopMod {
	Elf32_Word	moduleinfo;
	Elf32_Word	entry;
	Elf32_Word	gp_value;
	Elf32_Word	text_size;
	Elf32_Word	data_size;
	Elf32_Word	bss_size;
	Elf32_Half	moduleversion;
	char		modulename[1];	/* null terminate */
} Elf32_IopMod;
</pre></font></div>
<div style="margin-left:50px;"><br>entrýAvŐNGgAhXTEXT segment擪̃ItZbg܂B<br>gp_valuéAvOGP register̒lTEXT segment擪̃ItZbg܂B<br>text_size, data_size, bss_size͂ꂼTEXT, DATA, BSS segment̃TCY܂B<br>vODATA segmentModuleInfo\̂Moduleϐ݂Ƃ́AmoduleinfoModuleϐTEXT segment擪̃ItZbgAɁAmoduleversionModule.versioñRs[Amodulename[]ɂ́AModule.namẽRs[i[܂B<br>Moduleϐ݂ȂƂ́Amoduleinfoɂ0xffffffffAmoduleversionmodulename[0]ɂ́A0܂B<br><br>IOPW[ZNṼZNV ".iopmod"ƂȂAZNVwb_̊etB[hɂ͈ȉ̒li[܂B<br><br></div>
<div style="margin-left:90px;">
<table border=0>
<tr>
<td valign="TOP">&nbsp;sh_type&nbsp;</td>
<td valign="TOP">&nbsp;=  SHT_SCE_IOPMOD(=0x70000080)&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;sh_offset&nbsp;</td>
<td valign="TOP">&nbsp;=  ZNVf[^̃t@C擪̃ItZbg&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;sh_size&nbsp;</td>
<td valign="TOP">&nbsp;=  sizeof(Elf32_IopMod)+strlen(Elf32_IopMod.modulename)&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;sh_addralign&nbsp;</td>
<td valign="TOP">&nbsp;=  4&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;̑&nbsp;</td>
<td valign="TOP">&nbsp;=  0&nbsp;</td>
</tr>
</table>
</div>
<br>
<div style="margin-left:50px;">ȂAIOPIuWFNgt@Cɂ .reginfoZNV͕svłB<br>.reginfoZNV͓ȂłB<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_8_2">
<a href="#Heading3_8"> 8. </a>2 <b>t@C̃f[^CAEg</b><br>
</a>
</h3>
<div style="margin-left:50px;">WELF`P[^ut@Cł̓t@C̃f[^̔zu͂ƂɋK肳Ă܂񂪁AIOPIuWFNgtH[}bgł͈ȉ̏Ƀf[^łȂ΂܂B<br></div>
    <div style="margin-left:55px;"><ol>
         <li VALUE=1> ELFwb_</li>
         <li VALUE=2> vOwb_e[u</li>
         <li VALUE=3> IOPW[ZNVf[^</li>
         <li VALUE=4> TEXT, DATA segmentf[^</li>
         <li VALUE=5> ̑̃ZNVf[^</li>
         <li VALUE=6> ZNVwb_e[u</li>
         <li VALUE=7> TEXT, DATA segment̃P[Ve[uf[^</li>
         <li VALUE=8> ̑̃ZNVf[^</li>
</ol></div>
</ul></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_8_3">
<a href="#Heading3_8"> 8. </a>3 <b>̃f[^CAEg</b><br>
</a>
</h3>
<div style="margin-left:50px;">IOPW[́u2.W[\v́uZOg̔zuvŏqׂ悤ɃCAEgĂKv܂B<br>Ȃ킿ATEXT, DATA, BSSeZOg͂̏ŘAĔzualign0x10A܂16byteEłȂ΂Ȃ܂B<br><br>UNIXȂǂł́A.rodataZNV̂悤ȏs̃f[^TEXT segmentɊ܂܂邱Ƃ܂AIOP̃IuWFNgt@Cł͂͋܂B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_8_4">
<a href="#Heading3_8"> 8. </a>4 <b>ELFwb_̏ڍ</b><br>
</a>
</h3>
<div style="margin-left:50px;">ELFwb_̓éAȉ̂悤ɐݒ肳Ȃ΂Ȃ܂B<br><br></div>
<div style="margin-left:67px;">e_ident	== 'ELF', ELFCLASS32, ELFDATA2LSB,  EV_CURRENT<br>e_type	== ET_SCE_IOPRELEXEC (==0xFF80)܂ET_SCE_IOPRELEXEC2 (==0xFF81)<br>e_machine  == EM_MIPS<br>e_version  == EV_CURRENT<br>e_flags	== CӁij<br>e_entry	== vŐNGgAhXTEXT segment擪̃ItZbg<br>	(Elf32_IopMod.entryƓl)<br>e_ehsize	== sizeof(Elf32_Ehdr)<br>e_phoff	== vOwb_e[ũt@C̈ʒu<br>	( sizeof(Elf32_Ehdr)ƓɂȂ)<br>e_phentsize  == sizeof(Elf32_Phdr)<br>e_phnum  == 2<br>e_shoff	== ZNVwb_e[ũt@C̈ʒu<br>e_shentsize  == sizeof(Elf32_Shdr)<br>e_shnum  == t@C̃ZNV̐<br>e_shstrndx  == .shstrtabZNṼZNVCfbNX<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_8_5">
<a href="#Heading3_8"> 8. </a>5 <b>vOwb_e[ȕڍ</b><br>
</a>
</h3>
<div style="margin-left:50px;">vOwb_e[u͕KQ̗vfAȉ̏ɂȂĂ܂B<br></div>

<div style="margin-left:40px;"><h4><b>IOP Module Header</b><br></h4></div>

<div style="margin-left:90px;">
<table border=0>
<tr>
<td valign="top">&nbsp;p_type&nbsp;</td>
<td valign="top">&nbsp;== PT_SCE_IOPMOD( == 0x70000080)&nbsp;</td>
</tr>
<tr>
<td valign="top">&nbsp;p_flags&nbsp;</td>
<td valign="top">&nbsp;== PF_R&nbsp;</td>
</tr>
<tr>
<td valign="top">&nbsp;p_offset&nbsp;</td>
<td valign="top">&nbsp;== IOPW[ZNṼf[^̃t@C̈ʒu&nbsp;</td>
</tr>
<tr>
<td valign="top">&nbsp;p_filesz&nbsp;</td>
<td valign="top">&nbsp;== IOPW[ZNṼf[^̃TCY&nbsp;</td>
</tr>
<tr>
<td valign="top">&nbsp;&nbsp;&nbsp;</td>
<td valign="top">&nbsp;sizeof(Elf32_IopMod)+strlen(Elf32_IopMod.modulename)&nbsp;</td>
</tr>
<tr>
<td colspan= 2  valign="top">&nbsp;p_vaddr,p_memsz  == 0&nbsp;</td>
</tr>
<tr>
<td valign="top">&nbsp;p_align&nbsp;</td>
<td valign="top">&nbsp;== 4&nbsp;</td>
</tr></table>
</div>

<div style="margin-left:40px;"><h4><b>Segment Header</b><br></h4></div>

<div style="margin-left:90px;">
<table border=0>
<tr>
<td valign="TOP">&nbsp;p_type&nbsp;</td>
<td valign="TOP">&nbsp;== PT_LOAD&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;p_flags&nbsp;</td>
<td valign="TOP">&nbsp;== PF_R+PF_W+PF_X&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;p_offset&nbsp;</td>
<td valign="TOP">&nbsp;== TEXT segment f[^̃t@C̈ʒu&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;p_vaddr&nbsp;</td>
<td valign="TOP">&nbsp;== 0&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;p_filesz&nbsp;</td>
<td valign="TOP">&nbsp;== t@C̃[hf[^̃TCY&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;(TEXT segment size + DATA segment size)&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;p_memsz&nbsp;</td>
<td valign="TOP">&nbsp;== Ƀ[h̃f[^TCY&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;(TEXT segment size + DATA segment size + BSS segment size)&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;p_align&nbsp;</td>
<td valign="TOP">&nbsp;== 0x10&nbsp;</td>
</tr>
</table>
</div>

<!-- o@SCo -->
<h3>
<a name="Heading4_8_6">
<a href="#Heading3_8"> 8. </a>6 <b>\V{</b><br>
</a>
</h3>
<div style="margin-left:50px;">SCEIOPIuWFNgt@CWFl[^iopfixupł́Aȉ̗\V{܂B<br><br></div>
<div style="margin-left:90px;">
<table border=0>
<tr>
<td valign="TOP">&nbsp;_ftext&nbsp;</td>
<td valign="TOP">&nbsp;TEXTZOg̐擪AhX&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;_etext, etext&nbsp;</td>
<td valign="TOP">&nbsp;TEXTZOg̍Ōbyte̎̃AhX&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;_fdata&nbsp;</td>
<td valign="TOP">&nbsp;DATAZOg̐擪AhX&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;_edata, edata&nbsp;</td>
<td valign="TOP">&nbsp;DATAZOg̍Ōbyte̎̃AhX&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;_fbss&nbsp;</td>
<td valign="TOP">&nbsp;BSSZOg̐擪AhX&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;_end, end&nbsp;</td>
<td valign="TOP">&nbsp;BSSZOg̍Ōbyte̎̃AhX&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;_gp&nbsp;</td>
<td valign="TOP">&nbsp;gpWX^̏l&nbsp;</td>
</tr>
</table>
</div>
<br>
<div style="margin-left:50px;">L̃V{Ԃł͈ȉ̊֌W藧܂B<br></div>
<div style="margin-left:67px;">0 &lt;= ( _fdata - _etext ) &lt; 0x10<br>0 &lt;= ( _fbss - _edata ) &lt; 0x10<br></div>
<div style="margin-left:50px;"><br>vÕ\[X݊mۂ邽߂ɁAJ܂IOPIuWFNgt@CWFl[^́AL̃V{𐶐邱Ƃ𐄏܂B<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_8_7">
<a href="#Heading3_8"> 8. </a>7 <b>V{e[uGg</b><br>
</a>
</h3>
<div style="margin-left:50px;">V{e[ũe[uGgst_valuetB[h̕ێlAhXłꍇA̓ZNVItZbgł͂ȂAvOItZbgiTEXT segment̐擪̃ItZbgjƂȂ܂B<br><br>܂AL̗\V{̂Aetext, _etext, edata, _edata, _fbss,end, _end, _gp̃GǵAst_shndxtB[hSHN_RADDR(==0xff1f)܂B<br><br>ȊÓAWR3000pELFP[^ut@CƓłB<br></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_8_8">
<a href="#Heading3_8"> 8. </a>8 <b>P[Ve[uGg</b><br>
</a>
</h3>
<div style="margin-left:50px;">P[Ve[uGgɊւāAȉɋLqĂȂ͕W R3000 p ELF P[^ut@CƓɂȂ܂B<br>P[Ve[ũe[uGgr_offsettB[h́AP[Vł̏KpZNVf[^[ḧʒuvOItZbgiTEXT segment̐擪̃ItZbgji[Ar_symtB[h(==ELF_32_R_SYM(r_info))͏STN_UNDEFi[܂B<br><br>ELFP[^ut@C IOP IuWFNgt@CɕϊۂɁA r_sym tB[hĂV{̒lvOItZbgɕϊ̂AYZNVf[^̃P[VtB[hɓK؂ɑ܂Ȃ΂Ȃ܂B<br><br>Cu[X 2.5.2 ȑO IOP̃vO[_ł́AELF wb_ e_type  ET_SCE_IOPRELEXEC  IOP IuWFNgt@Ĉ݂[h\łB<br>̃IuWFNgt@Cŋ郊P[V^Cv͈ȉ 6 ^CvłB<br><br></div>
<div style="margin-left:67px;">R_MIPS_NONE<br>R_MIPS_16<br>R_MIPS_32<br>R_MIPS_26<br>R_MIPS_HI16<br>R_MIPS_LO16<br><br></div>
<div style="margin-left:50px;">e[u R_MIPS_HI16 ̎ɂ͕KΉ R_MIPS_LO16΂Ȃ܂B R_MIPS_LO16 ͒PƂő݂邱Ƃ͋܂B<br>Cu[X 2.5.3 ȍ~ IOP̃vO[_́A@\gāAL IOP IuWFNgt@Cɉ ELF wb_ e_type ET_SCE_IOPRELEXEC2  IOP IuWFNgt@C[h邱Ƃł܂B<br>̃IuWFNgt@Cŋ郊P[V^Cv͈ȉ 8 ^CvłB<br><br></div>
<div style="margin-left:67px;">R_MIPS_NONE<br>R_MIPS_16<br>R_MIPS_32<br>R_MIPS_26<br>R_MIPS_HI16<br>R_MIPS_LO16<br>R_MIPSSCE_MHI16(=0xfa)<br>R_MIPSSCE_ADDEND(=0xfb)<br></div>
<div style="margin-left:50px;"><br>e[u R_MIPS_HI16 ̎ɂ͕KΉ R_MIPS_LO16΂Ȃ܂BAR_MIPS_LO16 ͒PƂő݂邱Ƃ܂B<br>GNU  binutil Ȃǂł́ÃQƂ镡 R_MIPS_HI16 AA̒ɂɑΉ R_MIPS_LO16uIuWFNgt@C𐶐邱Ƃ܂B<br>̂悤ȘA R_MIPS_HI16 R[h́Ae_type   ET_SCE_IOPRELEXEC2 IOP IuWFNgt@Cł́Aȉɏqׂ R_MIPSSCE_MHI16 R_MIPSSCE_ADDEND ̃yAɕϊȂĂ͂Ȃ܂B<br>R_MIPSSCE_MHI16  R_MIPSSCE_ADDEND ͕K̏ŃyAŃe[uɘAĊi[Ȃ΂܂B<br><br>R_MIPSSCE_ADDEND R[h r_offset tB[h́AP[VŉZׂ(addend)ێĂ܂B<br>({߂̍ŏŏqׂ悤ɑ̃^CṽR[h r_offset tB[h́AP[Vł̏KpZNVf[^[ḧʒuvOItZbgێĂ܂B<br>Ȃ킿AR_MIPSSCE_ADDENDR[h r_offset tB[h͕ϑIȎgĂ܂B)<br><br>W ELF ̃P[VR[hƏsZNVf[^̃[hƂ͈ΈőΉĂ܂B<br>AR_MIPSSCE_MHI16 R[h́Ã^CṽR[hƂ͈قȂAs镡̃[hɑΉĂ܂B<br>Ỹ[hQ̂ꂼ̃P[VtB[h([h̉16rbg)́A[hQ֘At邽߂̐`Xg̃NtB[hƂėpꎟ̃[hւ̃[hPʂ̕t΃ItZbgi[Ă܂B<br>`Xg̖[ł́A΃ItZbgl 0 ɂȂ܂B<br>R_MIPSSCE_MHI16 R[h r_offset tB[hɂ͂̐`Xg̍ŏ̃[hwvOItZbg(TEXT segment ̐擪̃ItZbg)i[܂B<br>(L̃P[V̎QlR[hQƂĂB)<br><br>Cu[X 2.5.2 ȑO IOP̃vO[_̃P[VQl̂߈ȉɎ܂B<br></div>
        <div style="margin-left:80px;"><pre><font size=3>void OLD_apply_elf_rel_section(unsigned int textstart,Elf32_Rel *rp, int entrise)
	{
	@@int i, type, mhioff;
	@@unsigned int data, datalow, daddr, daddr1;

	@@for( i = 0; i &lt; entrise; i++, rp++ ) {
		@type = ELF32_R_TYPE(rp-&gt;r_info);
		@daddr = (unsigned int)(rp-&gt;r_offset + textstart);
		@switch( type ) {
		@case R_MIPS_NONE:
		@@break;
		@case R_MIPS_16:
		@@data = (unsigned int)( ((*(int *)daddr)&lt;&lt;16)&gt;&gt;16) + textstart;
		@@// if( (data&gt;&gt;16) != 0 && (data&gt;&gt;16) != 0xffff )
		@@//     panic("R_MIPS_16 data overflow\n");
		@@*(unsigned int *)daddr &= 0xffff0000;
		@@*(unsigned int *)daddr |= data&0xffff;
		@@break;
		@case R_MIPS_32:
		@@*(unsigned int *)(daddr) += textstart;
		@@break;
		@case R_MIPS_26:
		@@data = *(unsigned int *)daddr;
		@@data = (data & 0x03ffffff)&lt;&lt;2;
		@@data |= (daddr & 0xf0000000);
		@@data += textstart;
		@@*(unsigned int *)daddr &= 0xfc000000;
		@@*(unsigned int *)daddr |= (data&lt;&lt;4)&gt;&gt;6;
		@@break;
		@case R_MIPS_HI16:
		@@// if( i == entrise+1
		@@//     || ELF32_R_TYPE(rp[1].r_info) != R_MIPS_LO16
		@@//     || ELF32_R_SYM(rp[1].r_info) != SHN_UNDEF  ) {
		@@//     panic("R_MIPS_HI16 without R_MIPS_LO16\n");
		@@// }
		@@daddr1 = (unsigned int)( rp[1].r_offset + textstart );
		@@data  = (unsigned int)( (*(int *)daddr)&lt;&lt;16 );
		@@datalow = (unsigned int)( ((*(int *)daddr1)&lt;&lt;16)&gt;&gt;16 );
		@@data = data + datalow + textstart;
		@@*(unsigned int *)daddr  &= 0xffff0000;
		@@*(unsigned int *)daddr  |= (((data&gt;&gt;15)+1)&gt;&gt;1)&0xffff;
		@@*(unsigned int *)daddr1 &= 0xffff0000;
		@@*(unsigned int *)daddr1 |= data&0xffff;
		@@rp++; i++; /* skip R_MIPS_LO16 */
		@@break;
		@case R_MIPS_LO16:
		@@// panic("R_MIPS_LO16 without R_MIPS_HI16\n");
		@@break;
		@default:
		@@// panic("unacceptable relocation type: 0x%x\n", type);
		@@break;
		@}
	@@}
	}
</pre></font></div>
<div style="margin-left:50px;"><br>Cu[X 2.5.3 Ȍ IOP̃vO[_̃P[V̊TvQl̂߈ȉɎ܂B<br><br></div>
        <div style="margin-left:80px;"><pre><font size=3>void NEW_apply_elf_rel_section(unsigned int textstart, Elf32_Rel *rp, int entrise)
	{
	@@int i, type;
	@@unsigned int data, datalow, daddr, daddr1;

	@@for( i = 0; i &lt; entrise; i++, rp++ ) {
		@type = ELF32_R_TYPE(rp-&gt;r_info);
		@daddr = (unsigned int)(rp-&gt;r_offset+textstart);
		@switch( type ) {
		@// R_MIPS_NONE, R_MIPS_16, R_MIPS_32, R_MIPS_26 ͈ȑÕo[W
		@//@Ɠ̏
		@case R_MIPS_HI16:
		@@// if( i == entrise+1
		@@//     || ELF32_R_TYPE(rp[1].r_info) != R_MIPS_LO16
		@@//     || ELF32_R_SYM(rp[1].r_info) != SHN_UNDEF  ) {
		@@//     panic("R_MIPS_HI16 without R_MIPS_LO16\n");
		@@// }
		@@data  = (unsigned int)( (*(int *)daddr)&lt;&lt;16 );
		@@daddr1 = (unsigned int)( rp[1].r_offset + textstart );
		@@datalow = (unsigned int)( ((*(int *)daddr1)&lt;&lt;16)&gt;&gt;16 );
		@@data = data + datalow + textstart;
		@@*(unsigned int *)daddr  &= 0xffff0000;
		@@*(unsigned int *)daddr  |= (((data&gt;&gt;15)+1)&gt;&gt;1)&0xffff;
		@@break;
		@case R_MIPS_LO16:
		@@data = (unsigned int)( ((*(int *)daddr)&lt;&lt;16)&gt;&gt;16) + textstart;
		@@*(unsigned int *)daddr &= 0xffff0000;
		@@*(unsigned int *)daddr |= data&0xffff;
		@@break;
		@case R_MIPSSCE_MHI16:
		@@// if( i == entrise+1
		@@//     || ELF32_R_TYPE(rp[1].r_info) != R_MIPSSCE_ADDEND
		@@//     || ELF32_R_SYM(rp[1].r_info) != SHN_UNDEF  ) {
		@@//     panic("R_MIPSSCE_MHI16 without R_MIPSSCE_ADDEND\n");
		@@// }
		@@data = rp[1].r_offset + textstart;
		@@data = (((data&gt;&gt;15)+1)&gt;&gt;1)&0xffff;
		@@do {
			mhioff = (((*(int *)daddr)&0xffff)&lt;&lt;16)&gt;&gt;14;
			*(unsigned int *)daddr  &= 0xffff0000;
			*(unsigned int *)daddr  |= data;
			daddr += mhioff;
		@@} while( mhioff != 0 );
		@@rp++; i++; /* skip R_MIPSSCE_ADDEND */
		@@break;
		@default:
		@@// panic("unacceptable relocation type: 0x%x\n", type);
		@@break;
		@}
	@@}
}
</pre></font></div>

<!-- o@SCo -->
<h3>
<a name="Heading4_8_9">
<a href="#Heading3_8"> 8. </a>9 <b>fobO</b><br>
</a>
</h3>
<div style="margin-left:50px;">IOPIuWFNgtH[}bgł́AfobOɊւĂ̋K͍s܂B<br>܂AIOPvO[_́A{ŋK肵ȊÕZNV𖳎܂B<br>]āARpCx_͓Ǝ̃fobO܂ރZNVIOPIuWFNgt@CɊ܂߂Ă܂܂B<br>ASCẼ[eBeB́ASCEiop-gcciWR3000pgccƂقړj̐fobO񂪃ZNV ".mdebug"ZNV^CvSHT_MIPS_DEBUGł邱ƂOɂĂ̂ŁAMIPSpgccƔ݊̃fobO𐶐ꍇ́ÃZNV܂̓ZNV^CvgpĂ͂܂B<br><br></div>
<p><p><hr>
<div ALIGN="right">
    Copyright (c) 2002 Sony Computer Entertainment Inc.  All Rights Reserved.<br>
    SCE CONFIDENTIAL
</div>
</body>
</html>
