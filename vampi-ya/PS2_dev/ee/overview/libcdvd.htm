<html lang="ja">
<!-- 見出し　１，部見出し -->
<head>

<script language="JavaScript">
<!--
  function startFixed(){
    fixedLAYER('fixedLay0','rightBottom',-35,-35)
  }

  var ie= !!document.all
  var n4= !!document.layers
  var w3c=!!document.getElementById
  var mac45 
    = navigator.userAgent.indexOf('MSIE 4.5; Mac_PowerPC')

  if(document.layers)window.onresize=resizeFunc
  function resizeFunc(e){location.reload()}

  function iniFunc(){
    if(ie&&!(mac45!=-1))window.onscroll = startFixed
    startFixed()
  }

  var tid=new Array()

  function fixedLAYER(layName,posString,offSetX,offSetY){

    offSetX = parseInt(offSetX,10)
    offSetY = parseInt(offSetY,10)

 if( posString == 'rightBottom' ){

      if(ie) offLeft = document.body.clientWidth   + offSetX
      else   offLeft = window.innerWidth           + offSetX
      if(ie) offTop  = document.body.clientHeight  + offSetY
      else   offTop  = window.innerHeight          + offSetY

    }
    else {

      if(ie) offLeft =                               offSetX
      else   offLeft =                               offSetX
      if(ie) offTop  =                               offSetY
      else   offTop  =                               offSetY

    }

    offLeft = parseInt(offLeft)
    offTop  = parseInt(offTop)

    if(document.all){
      var mx = parseInt(document.body.scrollLeft +offLeft)
      var my = parseInt(document.body.scrollTop  +offTop)
    } else {
      var mx = parseInt(self.pageXOffset+offLeft)
      var my = parseInt(self.pageYOffset+offTop)

    }

    moveLAYER(layName,mx,my)

    if(!(ie&&!(mac45!=-1)))
      setTimeout("fixedLAYER('"+layName+"','"+posString
                   +"','" +offSetX+"','"+offSetY+"')",100)
  }

  function moveLAYER(layName,x,y){
      
      if(document.getElementById){
        document.getElementById(layName).style.left=x
        document.getElementById(layName).style.top=y
      }
      else if(document.all){
        document.all(layName).style.pixelLeft=x
        document.all(layName).style.pixelTop=y
      }
      else if(document.layers)
        document.layers[layName].moveTo(x,y)
  }

// -->
</script>

<script language="JavaScript">
<!--
  function lj(ch,fm)
  {
    if ( parent.index ) {
      if ( ch == "libref" ){ parent.index.location.href="../libref/category.htm"; }
      else if ( ch == "../ee/libref" ){ parent.index.location.href="../../ee/libref/category.htm"; }
      else if ( ch == "../iop/libref" ){ parent.index.location.href="../../iop/libref/category.htm"; }
      else if ( ch == "../iop/overview" ){ parent.index.location.href="../../iop/overview/category.htm"; }
      else if ( ch == "../ee/overview" ){ parent.index.location.href="../../ee/overview/category.htm"; }
      else if ( ch == "overview" ){ parent.index.location.href="../overview/category.htm"; }
    }
    if ( parent.main ) {
      if ( fm != "" ){ parent.main.location.href=fm; }
    } else {
      if ( fm != "" ){ location.href=fm; }
    }
  }
//-->
</script>
<title>CD(DVD)-ROMライブラリ</title>
<meta http-equiv="Content-Type"content= text/html; charset=Shift_JIS >
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta name="Author" Content="Sony Computer Entertainment Inc.">
<style type="text/css"><!--
    div.fixedLay{position:absolute;z-index:100;left:0px;top:0px;}
--></style>
</head>
<body onload="iniFunc()" bgcolor="#ffffff" text="#000000" >
<div id="fixedLay0" class="fixedLay">
<a href="#top"><img src="gif/link.gif" border="0" alt="TOP"></a>
</div>
<table WIDTH="100%">
<tr><td>
<h3>"PlayStation 2" Programmer Tool Runtime Library Release 2.5.3</h3>
</td>
</tr>
<tr><td align= right >
<script language="JavaScript">
<!--
   var p,q;
   if ( parent.index ) {
   p = parent.index.location;
   q = p.toString();
   result = q.match(/\/category\.htm/gi);
   if(result == "/category.htm"){
          document.writeln("<a href=\"JavaScript:lj('libref','../libref/ecdvd_rf.htm')\"><img src=\"./gif/arrow.png\" border=0>構造体／関数一覧(EE)</a><br>");
          document.writeln("<a href=\"JavaScript:lj('../iop/libref','../../iop/libref/icdvd_rf.htm')\"><img src=\"./gif/arrow.png\" border=0>構造体／関数一覧(IOP)</a>");
    }
}
// -->
</script>
</td></tr>
</table>
<hr noshade size=6>
<a name=Heading2>
<center><h1>
CD(DVD)-ROMライブラリ
</h1></center>
</a>
<div align=center>
<table border=0 bgcolor=#F5F5F5 width=90%><tr><td>
<h2><u>
        <b>目次</b><br>
</u></h2>

<ul>
<p><a href="#Heading3_1">  1 <b>ライブラリ概要</b><br></a>
    <ul>
    <a href="#Heading4_1_1"> <b>概要</b><br></a>
    <a href="#Heading4_1_2"> <b>関連ファイル</b><br></a>
    <a href="#Heading4_1_3"> <b>サンプルプログラム</b><br></a>
    </ul>
<p><a href="#Heading3_2">  2 <b>CD(DVD)-ROMの仕様</b><br></a>
    <ul>
    <a href="#Heading4_2_1"> <b>セクタサイズ</b><br></a>
    <a href="#Heading4_2_2"> <b>回転速度・データ転送速度</b><br></a>
    <a href="#Heading4_2_3"> <b>ファイルシステム</b><br></a>
    <a href="#Heading4_2_4"> <b>CD-XAおよびCD-DA</b><br></a>
    </ul>
<p><a href="#Heading3_3">  3 <b>CD(DVD)-ROMへのアクセス</b><br></a>
    <ul>
    <a href="#Heading4_3_1"> <b>メディアタイプの指定</b><br></a>
    <a href="#Heading4_3_2"> <b>ファイルへのアクセス手順</b><br></a>
    <a href="#Heading4_3_3"> <b>コールバックの利用</b><br></a>
    <a href="#Heading4_3_4"> <b>ストリーミングサポート</b><br></a>
    </ul>
<p><a href="#Heading3_4">  4 <b>注意事項</b><br></a>
    <ul>
    <a href="#Heading4_4_1"> <b>EE側 / IOP側の差違</b><br></a>
    <a href="#Heading4_4_2"> <b>実効データ読み出し速度</b><br></a>
    <a href="#Heading4_4_3"> <b>RPC再入に関する注意</b><br></a>
    <a href="#Heading4_4_4"> <b>cdvdfsv.irx(cdvd_ee_driver)アンロード後の処理に関する注意</b><br></a>
    <a href="#Heading4_4_5"> <b>DVD_Dual_Layerを使用する際の注意</b><br></a>
    <a href="#Heading4_4_6"> <b>ディスク交換処理について</b><br></a>
    </ul>
<p><a href="#Heading3_5">  5 <b>TRC規定事項</b><br></a>
    <ul>
    <a href="#Heading4_5_1"> <b>18.0 ディスクアクセスについて</b><br></a>
    <a href="#Heading4_5_2"> <b>20.0 ディスク交換可能なタイトルについて</b><br></a>
    </ul>
<br></td></tr></table></div>

<!-- 見出し　２，章見出し -->
<a name=#"Heading2">

<!-- 見出し　３，節見出し -->
<a name="Heading3_1">
<h2>
 1 <b>ライブラリ概要</b><br>
<hr noshade>
</h2>


<!-- 見出し　４，小見出し -->
<h3>
<a name="Heading4_1_1">
<a href="#Heading3_1"> 1. </a>1 <b>概要</b><br>
</a>
</h3>
<div style="margin-left:50px;">libcdvdはCD(DVD)-ROMドライブを制御するための基本的なライブラリです。CD(DVD)-ROMドライブを制御し、データをEE側およびIOP側メモリへ読み込む処理をサポートします。また、リアルタイムクロック機能がCD(DVD)-ROMドライブに搭載されているため、現在の日時を取得する関数がlibcdvdに含まれています。<br>libcdvdの各関数は、EE側/IOP側双方にインプリメントされています。EE上のプログラムからもIOP上のプログラムからでも、基本的に同じ機能の関数が同じ関数名で使用できます。<br></div>

<!-- 見出し　４，小見出し -->
<h3>
<a name="Heading4_1_2">
<a href="#Heading3_1"> 1. </a>2 <b>関連ファイル</b><br>
</a>
</h3>
<div style="margin-left:50px;">libcdvdを使用するために必要なファイルは次のとおりです。<br><br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>カテゴリ</b>&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>ファイル名</b>&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;ヘッダファイル&nbsp;</td>
<td valign="TOP">&nbsp;libcdvd.h&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;EE側ライブラリファイル&nbsp;</td>
<td valign="TOP">&nbsp;libcdvd.a&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;IOP側ライブラリファイル&nbsp;</td>
<td valign="TOP">&nbsp;cdvdman.ilb&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;IOP側モジュールファイル&nbsp;</td>
<td valign="TOP">&nbsp;cdvdman.irx&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;IOP側モジュールファイル&nbsp;</td>
<td valign="TOP">&nbsp;cdvdfsv.irx&nbsp;</td>
</tr>
</table>
</div>
<br>
<br>
<div style="margin-left:50px;">libcdvdのインクルードヘッダファイルは「libcdvd.h」で、EE側 / IOP側で共通に使用します。<br>libcdvdのライブラリファイルは、EE側のライブラリファイル「libcdvd.a」とIOP側のライブラリファイル「cdvdman.ilb」の2つがあります。それぞれ適切なライブラリファイルをリンクする必要があります。<br>このほかランタイムに必要なファイルとして、IOP側でlibcdvdの各サービスを提供するモジュール「cdvdman.irx」および、EE側からのリクエストにより「cdvdman.irx」の各モジュールを呼び出す「cdvdfsv.irx」があります。cdvdfsv.irxは、IOPメモリを節約するためアンロード可能になっています。アンロードした場合、EE側からはlibcdvdのサービスを利用することができなくなります。<br></div>

<!-- 見出し　４，小見出し -->
<h3>
<a name="Heading4_1_3">
<a href="#Heading3_1"> 1. </a>3 <b>サンプルプログラム</b><br>
</a>
</h3>
<div style="margin-left:50px;">libcdvdのサンプルプログラムとして、以下のものがありますので参照してください。<br></div>

<!-- 見出し　５，（１） -->
<div style="margin-left:40px;"><a name="Heading5_1_3_1"><h4>
(1)&nbsp;<b>sce/ee/sample/cdvd/smp_ee</b><br></h4>
</a></div>
<div style="margin-left:67px;">libcdvdライブラリの基本的な関数のEE側からの呼び出しサンプルです。<br></div>

<!-- 見出し　５，（１） -->
<div style="margin-left:40px;"><a name="Heading5_1_3_2"><h4>
(2)&nbsp;<b>sce/iop/sample/cdvd/smp_iop</b><br></h4>
</a></div>
<div style="margin-left:67px;">libcdvdライブラリの基本的な関数のIOP側からの呼び出しサンプルです。<br></div>

<!-- 見出し　５，（１） -->
<div style="margin-left:40px;"><a name="Heading5_1_3_3"><h4>
(3)&nbsp;<b>sce/iop/sample/cdvd/stmread</b><br></h4>
</a></div>
<div style="margin-left:67px;">ストリーム関数を使用してのファイルリードサンプルです。<br></div>

<!-- 見出し　５，（１） -->
<div style="margin-left:40px;"><a name="Heading5_1_3_4"><h4>
(4)&nbsp;<b>sce/iop/sample/cdvd/stmspcm</b><br></h4>
</a></div>
<div style="margin-left:67px;">ストリーム関数を利用してのストレートPCM再生のサンプルです。<br></div>

<!-- 見出し　５，（１） -->
<div style="margin-left:40px;"><a name="Heading5_1_3_5"><h4>
(5)&nbsp;<b>sce/iop/sample/cdvd/stmadpcm</b><br></h4>
</a></div>
<div style="margin-left:67px;">ストリーム関数を利用してのADPCM再生のサンプルです。<br></div>

<!-- 見出し　３，節見出し -->
<a name="Heading3_2">
<h2>
 2 <b>CD(DVD)-ROMの仕様</b><br>
<hr noshade>
</h2>


<!-- 見出し　４，小見出し -->
<h3>
<a name="Heading4_2_1">
<a href="#Heading3_2"> 2. </a>1 <b>セクタサイズ</b><br>
</a>
</h3>
<div style="margin-left:50px;">データセクタの読み込み実効ユーザエリアは、DVD-ROMでは2048バイト、CD-ROMでも標準的には2048バイトですが、libcdvdでは以下に示すデータサイズをサポートしています。<br><br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>ディスク</b>&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>モード</b>&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>データサイズ</b>&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;DVD-ROM&nbsp;</td>
<td valign="TOP">&nbsp;&nbsp;</td>
<td valign="TOP">&nbsp;USER_DATA(2048 byte)※&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;CD-ROM&nbsp;</td>
<td valign="TOP">&nbsp;MODE1&nbsp;</td>
<td valign="TOP">&nbsp;USER_DATA(2048 byte)&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;CD-ROM&nbsp;</td>
<td valign="TOP">&nbsp;MODE2/FORM1&nbsp;</td>
<td valign="TOP">&nbsp;USER_DATA(2048 byte)&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;CD-ROM&nbsp;</td>
<td valign="TOP">&nbsp;MODE2/FORM2&nbsp;</td>
<td valign="TOP">&nbsp;USER_DATA(2324 byte) + Reserved&nbsp;<br>&nbsp;(4 byte)&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;CD-ROM&nbsp;</td>
<td valign="TOP">&nbsp;MODE1&nbsp;</td>
<td valign="TOP">&nbsp;Header(4 byte) + USER_DATA&nbsp;<br>&nbsp;(2048 byte) + Parity(288 byte)&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;CD-ROM&nbsp;</td>
<td valign="TOP">&nbsp;MODE2&nbsp;</td>
<td valign="TOP">&nbsp;Header(4 byte) + USER_DATA&nbsp;<br>&nbsp;(2336 byte)&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;CD-ROM&nbsp;</td>
<td valign="TOP">&nbsp;MODE2/FORM1&nbsp;</td>
<td valign="TOP">&nbsp;Header(4 byte) + SubHeader(8 byte) +&nbsp;<br>&nbsp;USER_DATA(2048 byte) + Parity&nbsp;<br>&nbsp;(280 byte)&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;CD-ROM&nbsp;</td>
<td valign="TOP">&nbsp;MODE2/FORM2&nbsp;</td>
<td valign="TOP">&nbsp;Header(4 byte) + SubHeader(8 byte) +&nbsp;<br>&nbsp;USER_DATA(2324 byte) + Reserved&nbsp;<br>&nbsp;(4 byte)&nbsp;</td>
</tr>
</table>
</div>
<br>
<div style="margin-left:50px;">※DVD-ROMは、USER_DATA (2048 byte)のみサポート<br></div>

<!-- 見出し　４，小見出し -->
<h3>
<a name="Heading4_2_2">
<a href="#Heading3_2"> 2. </a>2 <b>回転速度・データ転送速度</b><br>
</a>
</h3>
<div style="margin-left:50px;">"PlayStation 2"では、ドライブの回転速度はヘッド位置によらず一定のCAV方式を採用しています。したがって、メディア内周と外周とではデータ転送速度が異なります。<br>仕様上のデータ転送速度は次のとおりです。<br><br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>ヘッド位置</b>&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>速度</b>&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;CD内周側&nbsp;</td>
<td valign="TOP">&nbsp;10倍速 ＝1500KB/sec（12.3Mbps）&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;CD外周側&nbsp;</td>
<td valign="TOP">&nbsp;24倍速 ＝3600KB/sec（28.8Mbps）&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;DVD内周側&nbsp;</td>
<td valign="TOP">&nbsp;1.6倍速＝2000KB/sec&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;DVD外周側&nbsp;</td>
<td valign="TOP">&nbsp;4倍速  ＝5000KB/sec&nbsp;</td>
</tr>
</table>
</div>
<br>
<br>
<div style="margin-left:50px;">現実には、エラーリトライ処理などが発生するためCD外周側で20倍速（3000KB/sec＝24Mbps）程度が上限となります。安定したデータ読み出しができるストリーミング速度としては、CD内周側で8Mbps、外周側で14Mbps、DVDでは15Mbps程度を目安としてください。<br>回転速度は以下の3とおりの方式で制御することができます。<br></div>
<div style="margin-left:40px;"><ul>
         <li> ストリーミングモード（SCECdSpinStm）：一定のデータ転送レートで安定した読み出しが行えるよう、回転速度を抑える。
         <li> 通常データモード（SCECdSpinNom）：まず最高速でトライし、エラーが発生すれば読み出しが行えるまで回転速度を落とす。
         <li> DVDデュアルレイアディスクのレイア0読み込みモード（SCECdSpinDvdDL0）： SCECdSpinStmに同じ。DVDデュアルレイアディスクのレイア0読み込み時に使用する。
</ul></div>

<!-- 見出し　４，小見出し -->
<h3>
<a name="Heading4_2_3">
<a href="#Heading3_2"> 2. </a>3 <b>ファイルシステム</b><br>
</a>
</h3>
<div style="margin-left:50px;">DVD-ROMおよびCD-ROMのファイルシステムはISO-9660をサポートしています。<br>ディレクトリ数およびファイル数等に下記の制限がありますがファイル名等の文字数を<br>少なくする事により最大数以上のファイルを扱う事が可能な場合もあります。<br><br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>項目</b>&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>制限</b>&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;ディレクトリ数&nbsp;</td>
<td valign="TOP">&nbsp;40ディレクトリ／システム&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;ディレクトリ階層の深さ&nbsp;</td>
<td valign="TOP">&nbsp;最大８階層&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;ファイル数&nbsp;</td>
<td valign="TOP">&nbsp;30ファイル／ディレクトリ&nbsp;</td>
</tr>
</table>
</div>
<br>
<div style="margin-left:50px;">なお、ISO-9660にはファイル名・ディレクトリ名に関して次の制限があります。<br><br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>項目</b>&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>制限</b>&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;ファイル名・ディレクトリ名に&nbsp;<br>&nbsp;使用できる文字&nbsp;</td>
<td valign="TOP">&nbsp;0〜9、A〜Z(大文字のみ)、_&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;ファイル名の形式&nbsp;</td>
<td valign="TOP">&nbsp;(ファイル名8文字)．(拡張子3文字)；１&nbsp;<br>&nbsp;※ロングファイル名不可&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;ディレクトリ名の形式&nbsp;</td>
<td valign="TOP">&nbsp;（ディレクトリ名8文字）※拡張子なし&nbsp;</td>
</tr>
</table>
</div>
<br>

<!-- 見出し　４，小見出し -->
<h3>
<a name="Heading4_2_4">
<a href="#Heading3_2"> 2. </a>4 <b>CD-XAおよびCD-DA</b><br>
</a>
</h3>
<div style="margin-left:50px;">CD-XAは"PlayStation 2"用ディスクとしては採用しません。ハードウェアによる再生サポートもありません。<br>CD-DAもハードウェアによる再生サポートはなく、音声等の再生はSPUストリーミング等の手法によって行います。<br></div>

<!-- 見出し　３，節見出し -->
<a name="Heading3_3">
<h2>
 3 <b>CD(DVD)-ROMへのアクセス</b><br>
<hr noshade>
</h2>


<!-- 見出し　４，小見出し -->
<h3>
<a name="Heading4_3_1">
<a href="#Heading3_3"> 3. </a>1 <b>メディアタイプの指定</b><br>
</a>
</h3>
<div style="margin-left:50px;">不正ディスク作成防止のために、プログラム中でメディアタイプを指定するしくみになっています。sceCdInit()で初期化後、正しいメディアがCD-ROMかDVD-ROMかを指定してsceCdMmode()を呼び出すことにより、もし指定と異なるメディアが使用されていればそれ以後CD(DVD)-ROMのリード処理がすべて失敗するようになります。<br>次の例は、CD-ROMを使用する場合の典型的な起動処理です。<br><br></div>
        <div style="margin-left:80px;"><pre><font size=3>#define IOPRP "cdrom0:\\MODULES\\"IOP_IMAGE_FILE";1"

int main()
{
	sceSifInitRpc(0);
	sceCdInit(SCECdINIT); /* CD/DVDメディアから起動する場合は必要です */
	sceCdMmode(SCECdCD); /*メディアタイプ＝CD-ROM */
	/* デフォルトモジュールのリプレース */
	while ( !sceSifRebootIop(IOPRP) );
	while( !sceSifSyncIop() );
	/* 再初期化 */
	sceSifInitRpc(0);
	sceCdInit(SCECdINIT);
	sceCdMmode(SCECdCD); /*メディアタイプ＝CD-ROM */
	sceFsReset();
	/* 以下省略 */
</pre></font></div>
<div style="margin-left:50px;"><br>なお、標準入出力関数を使用してこの処理を行うこともできます。ほかにlibcdvdの関数を使用しないのであれば、次のようにしてもよいでしょう。<br><br></div>
        <div style="margin-left:80px;"><pre><font size=3>	char arg[64],rbuf[64];
	
	/* Drive Ready Wait */;
	*((int *)arg)= 0;
	sceDevctl("cdrom0:", CDIOC_DISKRDY, arg, 4, rbuf, 4);
	
	/* メディアタイプ＝CD-ROM */
	*((int *)arg)= SCECdCD;
	sceDevctl("cdrom0:", CDIOC_MMODE, arg, 4, NULL, 0);
</pre></font></div>

<!-- 見出し　４，小見出し -->
<h3>
<a name="Heading4_3_2">
<a href="#Heading3_3"> 3. </a>2 <b>ファイルへのアクセス手順</b><br>
</a>
</h3>
<div style="margin-left:50px;">CD(DVD)-ROMへのアクセスはロジカルセクタナンバを指定して行うことと、ノンブロック型処理となることが特徴です。手順としては次のようになります。<br></div>
    <div style="margin-left:55px;"><ol>
         <li VALUE=1> ファイル名からセクタ番号を取得する<br>sceCdSearchFile()を用いて、ファイル名からロジカルセクタナンバを取得します（第1引数で指定するsceCdlFILE構造体のlsnに格納されます）。<br>（例）　ret = sceCdSearchFile(&fp, "\\SYSTEM.CNF;1");</li>
         <li VALUE=2> 読み込みの開始<br>sceCdRead()関数などにより、データの読み込みを開始します。sceCdRead()はノンブロック型であり、コマンドを発行するだけですぐにリターンします。<br>（例）　ret = sceCdRead(fp.lsn, rsec, (u_int *)bf, &mode);</li>
         <li VALUE=3> 読み込み終了を待つ<br>sceCdSync()関数を用いて読み込み処理の終了を待ちます。ブロッキングして待つ方法とポーリングする方法があります。<br>（ブロッキングの例）<br>　　　ret = sceCdSync(0);<br>（ポーリングの例）<br>　　　while(sceCdSync(1)) {<br>　　　　　　/*他の処理*/<br>　　　}</li>
         <li VALUE=4> エラー情報の取得<br>sceCdGetError()関数を用いてエラー発生の有無を確認します。<br>（例）　if (sceCdGetError()==SCECdErNO) /*エラーなし*/</li>
</ol></div>
</ul></div>

<!-- 見出し　４，小見出し -->
<h3>
<a name="Heading4_3_3">
<a href="#Heading3_3"> 3. </a>3 <b>コールバックの利用</b><br>
</a>
</h3>
<div style="margin-left:50px;">ノンブロック型関数の終了を待つ際に、コールバック関数を利用する方法があります。<br>あらかじめsceCdCallback()を用いてコールバック関数を設定しておくと、sceCdRead()などのノンブロック型関数が終了したときに、どのノンブロック型関数が終了したのかを表すパラメータとともにそのコールバック関数が呼び出されます。<br></div>

<!-- 見出し　４，小見出し -->
<h3>
<a name="Heading4_3_4">
<a href="#Heading3_3"> 3. </a>4 <b>ストリーミングサポート</b><br>
</a>
</h3>
<div style="margin-left:50px;">ストリーミング処理をサポートするために、IOPメモリにリングバッファを設けてディスクからバックグラウンドでデータを読み込む関数群が用意されています。<br><br></div>
<div style="margin-left:90px;">
<table border=1>
<tr>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>関数</b>&nbsp;</td>
<td valign="TOP" bgcolor="#cccccc">&nbsp;<b>機能</b>&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;sceCdStInit&nbsp;</td>
<td valign="TOP">&nbsp;ストリーマ初期化・バッファ設定&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;sceCdStStart&nbsp;</td>
<td valign="TOP">&nbsp;ストリーミング開始&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;sceCdStRead&nbsp;</td>
<td valign="TOP">&nbsp;バッファからのデータ読み出し&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;sceCdStPause&nbsp;</td>
<td valign="TOP">&nbsp;ストリーミング一時停止&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;sceCdStResume&nbsp;</td>
<td valign="TOP">&nbsp;ストリーミング再開&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;sceCdStSeek&nbsp;</td>
<td valign="TOP">&nbsp;ストリーム読み出し位置の変更&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;sceCdStStat&nbsp;</td>
<td valign="TOP">&nbsp;バッファへの読み込み状況取得&nbsp;</td>
</tr>
<tr>
<td valign="TOP">&nbsp;sceCdStStop&nbsp;</td>
<td valign="TOP">&nbsp;ストリーミング終了&nbsp;</td>
</tr>
</table>
</div>
<br>
<br>
<div style="margin-left:50px;">sceCdStInit()で初期化したあと、sceCdStStart()を呼び出すと指定セクタ以降のデータがバックグラウンドで読み込まれ、バッファに蓄積されます。sceCdStRead()を呼び出すとバッファにあるデータを順次読み出すことができます。<br>ストリーミング処理中は、以下のlibcdvdの関数を使ってディスクにアクセスすることはできませんので注意してください。<br></div>
<div style="margin-left:67px;">sceCdChangeThreadPriority()<br>sceCdGetToc()<br>sceCdInit()<br>sceCdMmode()<br>sceCdPause()<br>sceCdRead()<br>sceCdReadChain()<br>sceCdReadIOPm()<br>sceCdSearchFile()<br>sceCdSeek()<br>sceCdStandby()<br>sceCdStop()<br>sceCdSync()<br>sceCdDiskReady()<br>sceCdGetError()<br>sceCdGetReadPos()<br></div>

<!-- 見出し　３，節見出し -->
<a name="Heading3_4">
<h2>
 4 <b>注意事項</b><br>
<hr noshade>
</h2>


<!-- 見出し　４，小見出し -->
<h3>
<a name="Heading4_4_1">
<a href="#Heading3_4"> 4. </a>1 <b>EE側 / IOP側の差違</b><br>
</a>
</h3>
<div style="margin-left:50px;">libcdvdの各関数は、EE側 / IOP側どちらからでも、基本的に同じ機能の関数を同じ関数名で使用できます。ただし、CD(DVD)-ROMドライブはIOP側に接続されているため、図に示すように、EE側の関数はIOP側で読み出したデータをSIF経由で転送するという、間接的な処理を行っています。<br></div>
<div style="margin-left:50px;"></div>
<div align=center>
<p>
<img src="gif/libcdvd001.gif"><p>
<b>図 1 libcdvdのデータフロー</b>

</div>
<br>
<div style="margin-left:50px;">このようにデータフローが異なるため、EE側ライブラリとIOP側ライブラリでは下記のような差違が生じます。<br></div>
<div style="margin-left:40px;"><ul>
         <li> データ読み込みの終了は、EE側ではドライブのデータ読み込みの終了ではなく、EE側メモリへのデータ転送の終了となる。
         <li> 各関数からのサブシステムへのコマンド発行の成否は、EE側ではドライブのステータスに加えてSIFのステータスにも影響を受ける。SIF RPCの再入についても注意を払う必要がある。
         <li> EE側へのデータ転送に際して、バッファアドレスのアライメント補正を行う場合がある。なるべく64バイトのアライメントが望ましい。
         <li> EE側でlibcdvdの関数を呼び出した場合、IOP側の動作モジュールのプライオリティは81に設定される。一方、IOP側でlibcdvdの関数を呼び出した場合、プライオリティはユーザーアプリケーションと同じ値となる。したがってIOP側では他の動作中スレッドのプライオリティを考慮に入れたコーディングが必要になる。
</ul></div>
<div style="margin-left:50px;">なお、EE側から呼び出されるlibcdvdの関数とIOP側から呼び出される関数とは互いに独立しています。EE側から呼び出した処理のステータスをIOP側でsceCdSync()を呼び出して取得するといったことはできません。また、ドライブサブシステムに対するコマンド発行が重複した場合、libcdvdはコマンド発行に失敗したものとしてエラー0を返します。<br></div>

<!-- 見出し　４，小見出し -->
<h3>
<a name="Heading4_4_2">
<a href="#Heading3_4"> 4. </a>2 <b>実効データ読み出し速度</b><br>
</a>
</h3>
<div style="margin-left:50px;">CD(DVD)-ROMからのデータ読み出し速度は内外周で異なるうえ、メディアの傷や偏重心などによるエラーの発生状況は予測できません。<br>読み出し速度が落ちる場合もあることを十分に考慮し、読み出し速度に直接依存するようなプログラミングは避けるようにしてください。<br></div>

<!-- 見出し　４，小見出し -->
<h3>
<a name="Heading4_4_3">
<a href="#Heading3_4"> 4. </a>3 <b>RPC再入に関する注意</b><br>
</a>
</h3>
<div style="margin-left:50px;">libcdvdのほとんどの関数は、EE側から呼び出した場合はSIF RPCを内部で使用します。そのため、libcdvdの関数を複数のスレッドで利用する場合はRPC再入を起さないように注意が必要です。RPC再入については「SIFシステム」ドキュメントに解説がありますので参照してください。<br></div>

<!-- 見出し　５，（１） -->
<div style="margin-left:40px;"><a name="Heading5_4_3_1"><h4>
(1)&nbsp;<b>RPC WAIT関数</b><br></h4>
</a></div>
<div style="margin-left:67px;">以下の関数はsceSifBindRpc() / sceSifCallRpc()をWAIT実行します。RPC再入に注意するほか、割り込み禁止状態や割り込みハンドラ内で呼び出さないようにしてください。<br></div>
<div style="margin-left:40px;"><ul>
         <li> sceCdBreak()
         <li> sceCdDiskReady()
         <li> sceCdGetDiskType()
         <li> sceCdGetError()
         <li> sceCdGetReadPos()
         <li> sceCdGetToc()
         <li> sceCdInit()
         <li> sceCdReadClock()
         <li> sceCdSearchFile()
         <li> sceCdStatus()
         <li> sceCdStInit()
         <li> sceCdStPause()
         <li> sceCdStRead()
         <li> sceCdStResume()
         <li> sceCdStSeek()
         <li> sceCdStStart()
         <li> sceCdStStat()
         <li> sceCdStStop()
         <li> sceCdTrayReq()
</ul></div>

<!-- 見出し　５，（１） -->
<div style="margin-left:40px;"><a name="Heading5_4_3_2"><h4>
(2)&nbsp;<b>RPC NOWAIT関数</b><br></h4>
</a></div>
<div style="margin-left:67px;">以下の関数（sceCdSync()で処理終了を検出するタイプの関数）はsceSifBindRpc() / sceSifCallRpc()をNOWAIT実行します。RPC再入に注意するほか、割り込みハンドラ内では呼び出さないようにしてください。<br></div>
<div style="margin-left:40px;"><ul>
         <li> sceCdReadChain()
         <li> sceCdRead()
         <li> sceCdReadIOPm()
         <li> sceCdSeek()
         <li> sceCdStandby()
         <li> sceCdStop()
         <li> sceCdPause()
</ul></div>

<!-- 見出し　５，（１） -->
<div style="margin-left:40px;"><a name="Heading5_4_3_3"><h4>
(3)&nbsp;<b>RPCチェック関数</b><br></h4>
</a></div>
<div style="margin-left:67px;">以下の関数はsceSifCheckStatRpc()を呼び出します。RPC再入に注意して使用してください。<br></div>
<div style="margin-left:40px;"><ul>
         <li> sceCdSync()
</ul></div>

<!-- 見出し　５，（１） -->
<div style="margin-left:40px;"><a name="Heading5_4_3_4"><h4>
(4)&nbsp;<b>非RPC関数</b><br></h4>
</a></div>
<div style="margin-left:67px;">以下の関数はsceSifBindRpc() / sceSifCallRpc()を使用しません。RPC再入を考慮することなく使用できます（これらの関数自体が再入可能という意味ではありません）。<br></div>
<div style="margin-left:40px;"><ul>
         <li> sceCdCallback()
         <li> sceCdInitEeCB()
         <li> sceCdIntToPos()
         <li> sceCdPosToInt()
         <li> sceCdSync()
</ul></div>

<!-- 見出し　４，小見出し -->
<h3>
<a name="Heading4_4_4">
<a href="#Heading3_4"> 4. </a>4 <b>cdvdfsv.irx(cdvd_ee_driver)アンロード後の処理に関する注意</b><br>
</a>
</h3>
<div style="margin-left:50px;">cdvdfsv.irxをアンロードすると、EEからlibcdvdの関数は使用できなくなります。アンロード後にEEからCD(DVD)-ROMのアクセスを行なうには、標準入出力関数を使用してください。<br>また、ハードディスクドライブ（EXPANTION BAYタイプ）の電源OFF処理の際に使用するsceCdPOffCallback() / sceCdPowerOff()については、標準入出力関数のscePowerOffHandler()およびdevctlコマンドCDIOC_POWEROFFを使用してください。アンロード後の電源OFF処理方法は、以下のとおりです。<br></div>
    <div style="margin-left:55px;"><ol>
         <li VALUE=1> scePowerOffHandler()で割り込み処理を検出する</li>
         <li VALUE=2> ファイル等をクローズする</li>
         <li VALUE=3> dev9の電源をOFFする</li>
         <li VALUE=4> 標準関数sceDevctl()のCDIOC_POWEROFFで"PlayStation 2"本体の電源をOFFする</li>
</ol></div>
</ul></div>
<div style="margin-left:50px;">詳細については、標準入出力関数リファレンス（io_rf）、CD(DVD)-ROMライブラリリファレンス（cdvd_rf）、およびPlayStation File System概要（pfs）を参照してください。<br></div>

<!-- 見出し　４，小見出し -->
<h3>
<a name="Heading4_4_5">
<a href="#Heading3_4"> 4. </a>5 <b>DVD_Dual_Layerを使用する際の注意</b><br>
</a>
</h3>
    <div style="margin-left:55px;"><ol>
         <li VALUE=1> DVD_Dual_Layerは必ずParallel track pathを使用する。</li>
         <li VALUE=2> Layer 0と Layer1のロジカルセクタ（ＬＳＮ）は連続しています。すなわちLayer 0の終端セクタの次セクタがLayer1の開始セクタになります。</li>
         <li VALUE=3> Layer1の先頭１６セクタには絶対アクセスしないようお願いいたします。</li>
         <li VALUE=4> ISO9660のファイルシステムはLayer0及びLayer1にて独自に存在します。標準入出力にてファイルアクセスを行なう場合は、デバイス識別子”cdrom0:"にてLayer0を”cdrom1:"にてLayer1のファイルシステムをアクセスします。また、ファイルの存在するロジカルセクタ（ＬＳＮ）を取得するにはsceCdLayerSearchFile()関数を使用します。</li>
         <li VALUE=5> 開発時には1層のDVD-Rを2枚使用して開発を行なう必要がある為、ライブラリはアクセスがLayer間を跨る場合、デバッガ"dsidb"のコンソールに”CDVD:Exchange it for the Layer_[0-1]_Disk Please.”のメッセージを表示してトレイをオープンします。アクセスを行なうLayerのメディアをトレイにセットしてトレイを閉じてください。また開発時には必ず、sceCdReadDvdDualInfo()関数の呼び出しを行なってください。</li>
         <li VALUE=6> sceCdRead()関数等で、Layer0アクセス際は読み込みモード指定構造体”sceCdRMode”のメンバ”spindlctrlに必ず、”SCECdSpinDvdDL0”を指定してください。</li>
         <li VALUE=7> 全ての機種にてより安定した動作を行なう為、レイア間のアクセスの移動は極力最低限にとどめてください。</li>
         <li VALUE=8> PS2DVD Dual_Layerの使用できる最大セクタ数は2084960(sector)×２:4169904(sector)です。但し、ファイルシステム等の領域を含みます。</li>
</ol></div>
</ul></div>

<!-- 見出し　４，小見出し -->
<h3>
<a name="Heading4_4_6">
<a href="#Heading3_4"> 4. </a>6 <b>ディスク交換処理について</b><br>
</a>
</h3>
<div style="margin-left:50px;">実行中にディスク交換を行うアプリケーションでは、交換後にディスクの内容をチェックし、新しく挿入されたディスクが正しいものかどうかを判別する必要があります。もし間違ったディスクが挿入された場合にはその旨のメッセージを表示して、再交換を求めてください。なお、このとき"PlayStation 2"非対応のディスク、たとえばパソコン用のCD-ROMなどが挿入されると、CD(DVD)-ROMドライブがハングアップする可能性があります。ソフトウェア側では対処できませんので、解説書にその旨の注意を記載してください。<br>また、ディスク交換時にディスクトレイを開ける動作をアプリケーション側で行っている場合、メッセージを表示してディスクトレイが開くことをユーザに知らせる必要があります。<br></div>

<!-- 見出し　３，節見出し -->
<a name="Heading3_5">
<h2>
 5 <b>TRC規定事項</b><br>
<hr noshade>
</h2>

<div style="margin-left:50px;">タイトルアプリケーションでlibcdvdを使用する際には、TRC（Technical Requirement Checklist）で次の事柄が規定されていますので注意してください。<br></div>

<!-- 見出し　４，小見出し -->
<h3>
<a name="Heading4_5_1">
<a href="#Heading3_5"> 5. </a>1 <b>18.0 ディスクアクセスについて</b><br>
</a>
</h3>

<div style="margin-left:40px;"><h4><b>初期化処理</b><br></h4></div>

<div style="margin-left:67px;">CD(DVD)-ROMサブシステムの初期化をsceCdInit()を呼び出して行ってください。また、それに続いてsceCdMmode()を呼び出してメディア種別を指定してください。<br></div>

<div style="margin-left:40px;"><h4><b>戻り値のエラーチェック</b><br></h4></div>

<div style="margin-left:67px;">ディスクにアクセスする関数が返す値を無視してはいけません。必ず戻り値をチェックして、エラーに対処してください。<br></div>

<div style="margin-left:40px;"><h4><b>リードエラー時の無限リトライ</b><br></h4></div>

<div style="margin-left:67px;">sceCDRead()そのほかで読み出しエラーが起こった場合（sceCdGetError()がSCECdErREADを返した場合）には、データが読み出せるまで繰り返し再読み出しを続けるようにプログラムを作成してください。また、この際に適切なメッセージを表示してユーザに通知することが推奨されています。<br></div>

<div style="margin-left:40px;"><h4><b>ディスク速度に依存する処理の禁止</b><br></h4></div>

<div style="margin-left:67px;">先に解説したように、ディスクの速度に直接依存するような処理を行ってはいけません。<br></div>

<!-- 見出し　４，小見出し -->
<h3>
<a name="Heading4_5_2">
<a href="#Heading3_5"> 5. </a>2 <b>20.0 ディスク交換可能なタイトルについて</b><br>
</a>
</h3>

<div style="margin-left:40px;"><h4><b>ディスクトレイオープン時のメッセージ表示</b><br></h4></div>

<div style="margin-left:67px;">ディスクの交換を行う際にsceCdTrayReq()を用いて自動的にディスクトレイを開けるのであれば、ディスクトレイが開くことをユーザに知らせるメッセージを表示するようにしてください。<br></div>

<div style="margin-left:40px;"><h4><b>正しいディスクの識別処理</b><br></h4></div>

<div style="margin-left:67px;">ディスクが交換されたあと、新しくセットされたディスクが適切なディスクかどうかをファイル内容などによって判断し、正しくないディスクであればその旨のメッセージを表示するようにしてください。<br></div>
<p><p><hr>
<div ALIGN="right">
    Copyright (c) 2002 Sony Computer Entertainment Inc.  All Rights Reserved.<br>
    SCE CONFIDENTIAL
</div>
</body>
</html>
